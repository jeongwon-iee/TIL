# π± μ¤ν”„λ§ μ»¨ν…μ΄λ„μ™€ μ¤ν”„λ§ λΉ

## μ¤ν”„λ§ μ»¨ν…μ΄λ„ μƒμ„±

μ¤ν”„λ§ μ»¨ν…μ΄λ„κ°€ μƒμ„±λλ” κ³Όμ •μ„ μ•μ•„λ³΄μ.

```java
ApplicaionContext applicationContext = 
		new AnnotationConfigApplicaionContext(AppConfig.class);
```

- `ApplicationContext`λ¥Ό μ¤ν”„λ§ μ»¨ν…μ΄λ„λΌ ν•λ‹¤.
- `ApplicationContext`λ” μΈν„°νμ΄μ¤μ΄λ‹¤. β†’ `AnnotationConfigApplicaionContext`κ°€ κµ¬ν„
- μ¤ν”„λ§ μ»¨ν…μ΄λ„λ” XMLμ„ κΈ°λ°μΌλ΅ λ§λ“¤ μ μκ³ , μ• λ…Έν…μ΄μ… κΈ°λ°μ μλ°” μ„¤μ • ν΄λμ¤λ΅ λ§λ“¤ μ μλ‹¤.
- μ§μ „μ— `AppConfig` λ¥Ό μ‚¬μ©ν–λ λ°©μ‹μ΄ *μ• λ…Έν…μ΄μ… κΈ°λ°μ μλ°” μ„¤μ • ν΄λμ¤λ΅ μ¤ν”„λ§ μ»¨ν…μ΄λ„λ¥Ό λ§λ“  κ²ƒ*μ΄λ‹¤.
- μλ°” μ„¤μ • ν΄λμ¤λ¥Ό κΈ°λ°μΌλ΅ μ¤ν”„λ§ μ»¨ν…μ΄λ„( `ApplicationContext` )λ¥Ό λ§λ“¤μ–΄λ³΄μ.
    - `new AnnotationConfigApplicationContext(AppConfig.class);`
    - λ§¤κ°λ³€μλ΅ `AppConfig` classλ¥Ό λ„£μ–΄μ¤€λ‹¤.
    - μ΄ ν΄λμ¤λ” ApplicationContext μΈν„°νμ΄μ¤μ κµ¬ν„μ²΄μ΄λ‹¤.

*μ°Έκ³ *  λ” μ •ν™•νλ” μ¤ν”„λ§ μ»¨ν…μ΄λ„λ¥Ό λ¶€λ¥Ό λ• `BeanFactory` , `ApplicationContext` λ΅ κµ¬λ¶„ν•΄μ„ μ΄μ•ΌκΈ° ν•λ‹¤. `BeanFactory` λ¥Ό μ§μ ‘ μ‚¬μ©ν•λ” κ²½μ°λ” κ±°μ μ—†μΌλ―€λ΅ μΌλ°μ μΌλ΅ `ApplicationContext` λ¥Ό μ¤ν”„λ§ μ»¨ν…μ΄λ„λΌ ν•λ‹¤.

### μ¤ν”„λ§ μ»¨ν…μ΄λ„ μƒμ„± κ³Όμ •

1. **μ¤ν”„λ§ μ»¨ν…μ΄λ„ μƒμ„±**  

    <img width="833" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2021-02-27 α„‹α…©α„’α…® 4 42 05" src="https://user-images.githubusercontent.com/45806836/109380930-bbb14680-791a-11eb-99a0-f7b8a49875f8.png">
    
    - `new AnnotationConfigApplicationContext(AppConfig.class)`
    - μ¤ν”„λ§ μ»¨ν…μ΄λ„λ¥Ό μƒμ„±ν•  λ•λ” κµ¬μ„± μ •λ³΄λ¥Ό μ§€μ •ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤. (`AppConfig` ν΄λμ¤λ¥Ό νλΌλ―Έν„°λ΅)
    - μ—¬κΈ°μ„λ” `AppConfig.class` λ¥Ό κµ¬μ„± μ •λ³΄λ΅ μ§€μ •ν–λ‹¤.
2. **μ¤ν”„λ§ λΉ λ“±λ΅**  

    
    <img width="833" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2021-02-27 α„‹α…©α„’α…® 4 42 48" src="https://user-images.githubusercontent.com/45806836/109380951-d5eb2480-791a-11eb-9edf-1dca54f673eb.png">

    - μ¤ν”„λ§ μ»¨ν…μ΄λ„λ” νλΌλ―Έν„°λ΅ λ„μ–΄μ¨ μ„¤μ • ν΄λμ¤ μ •λ³΄λ¥Ό μ‚¬μ©ν•΄μ„ μ¤ν”„λ§ λΉμ„ λ“±λ΅ν•λ‹¤.

    **λΉ μ΄λ¦„**  

    - λΉ μ΄λ¦„μ€ λ©”μ„λ“ μ΄λ¦„μ„ μ‚¬μ©ν•κ³ , μ•„λμ™€ κ°™μ΄ λΉ μ΄λ¦„μ„ μ§μ ‘ λ¶€μ—¬ν•  μλ„ μλ‹¤.
        - `@Bean(name="memberService2")`

    *μ£Όμ*  λΉ μ΄λ¦„μ€ ν•­μƒ λ‹¤λ¥Έ μ΄λ¦„μ„ λ¶€μ—¬ν•΄μ•Ό ν•λ‹¤. κ°™μ€ μ΄λ¦„μ„ λ¶€μ—¬ν•λ©΄, λ‹¤λ¥Έ λΉμ΄ λ¬΄μ‹λκ±°λ‚, κΈ°μ΅΄ λΉμ„ λ®μ–΄λ²„λ¦¬κ±°λ‚ μ„¤μ •μ— λ”°λΌ μ¤λ¥κ°€ λ°μƒν•λ‹¤.

3. **μ¤ν”„λ§ λΉ μμ΅΄κ΄€κ³„ μ„¤μ • - μ¤€λΉ„**  

    
    <img width="832" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2021-02-27 α„‹α…©α„’α…® 4 43 04" src="https://user-images.githubusercontent.com/45806836/109380961-dedbf600-791a-11eb-864e-69ef97073d41.png">

4. **μ¤ν”„λ§ λΉ μμ΅΄κ΄€κ³„ μ„¤μ • - μ™„λ£**  

    
    <img width="833" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2021-02-27 α„‹α…©α„’α…® 4 43 19" src="https://user-images.githubusercontent.com/45806836/109380968-e7ccc780-791a-11eb-8aff-a3f663f0e7bf.png">  
    - μ¤ν”„λ§ μ»¨ν…μ΄λ„λ” μ„¤μ • μ •λ³΄λ¥Ό μ°Έκ³ ν•΄μ„ μμ΅΄κ΄€κ³„λ¥Ό μ£Όμ…(DI)ν•λ‹¤.
    - λ‹¨μν μλ°” μ½”λ“λ¥Ό νΈμ¶ν•λ” κ²ƒ κ°™μ§€λ§, μ°¨μ΄κ°€ μλ‹¤.

**μ°Έκ³ **

μ¤ν”„λ§μ€ λΉμ„ μƒμ„±ν•κ³ , μμ΅΄κ΄€κ³„λ¥Ό μ£Όμ…ν•λ” λ‹¨κ³„κ°€ λ‚λ„μ–΄μ Έ μλ‹¤. κ·Έλ°λ° μ΄λ ‡κ² μλ°” μ½”λ“λ΅ μ¤ν”„λ§ λΉμ„ λ“±λ΅ν•λ©΄ μƒμ„±μλ¥Ό νΈμ¶ν•λ©΄μ„ μμ΅΄κ΄€κ³„ μ£Όμ…λ„ ν•λ²μ— μ²λ¦¬λλ‹¤. 

**μ •λ¦¬**

μ¤ν”„λ§ μ»¨ν…μ΄λ„λ¥Ό μƒμ„±ν•κ³ , μ„¤μ •(κµ¬μ„±) μ •λ³΄λ¥Ό μ°Έκ³ ν•΄μ„ μ¤ν”„λ§ λΉλ„ λ“±λ΅ν•κ³ , μμ΅΄κ΄€κ³„λ„ μ„¤μ •ν–λ‹¤.  
μ΄μ  μ¤ν”„λ§ μ»¨ν…μ΄λ„μ—μ„ λ°μ΄ν„°λ¥Ό μ΅°νν•΄λ³΄μ.

&nbsp;

## μ»¨ν…μ΄λ„μ— λ“±λ΅λ λ¨λ“  λΉ μ΅°ν

μ¤ν”„λ§ μ»¨ν…μ΄λ„μ— μ‹¤μ  μ¤ν”„λ§ λΉλ“¤μ΄ μ λ“±λ΅ λμ—λ”μ§€ ν™•μΈν•΄λ³΄μ.

```java
public class ApplicationContextInfoTest {

    AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

    @Test
    @DisplayName("λ¨λ“  λΉ μ¶λ ¥ν•κΈ°")
    void findAllBean() {
        String[] beanDefinitionNames = ac.getBeanDefinitionNames();
        for (String beanDefinitionName : beanDefinitionNames) {
            Object bean = ac.getBean(beanDefinitionName);
            System.out.println("beanDefinitionName = " + beanDefinitionName + ", object = " + bean);
        }
    }

    @Test
    @DisplayName("μ• ν”λ¦¬μΌ€μ΄μ… λΉ μ¶λ ¥ν•κΈ°")
    void findApplicationBean() {
        String[] beanDefinitionNames = ac.getBeanDefinitionNames();
        for (String beanDefinitionName : beanDefinitionNames) {
            BeanDefinition beanDefinition = ac.getBeanDefinition(beanDefinitionName);
            if (beanDefinition.getRole() == BeanDefinition.ROLE_APPLICATION) {
                Object bean = ac.getBean(beanDefinitionName);
                System.out.println("beanDefinitionName = " + beanDefinitionName + ", object = " + bean);
            }
        }
    }
}
```

*μ°Έκ³ * λ¦¬μ¤νΈλ‚ λ°°μ—΄μ΄ μμ„ κ²½μ° `iter` + `tab` ν•λ©΄ for eachλ¬Έμ΄ μλ™ μ™„μ„± λ¨.

- λ¨λ“  λΉ μ¶λ ¥ν•κΈ°
    - μ‹¤ν–‰ν•λ©΄ μ¤ν”„λ§μ— λ“±λ΅λ λ¨λ“  λΉ μ •λ³΄λ¥Ό μ¶λ ¥ν•  μ μλ‹¤.
    - `ac.getBeanDefinitionNames()` : μ¤ν”„λ§μ— λ“±λ΅λ λ¨λ“  λΉ μ΄λ¦„μ„ μ΅°νν•λ‹¤.
    - `ac.getBean()` : λΉ μ΄λ¦„μΌλ΅ λΉ κ°μ²΄(μΈμ¤ν„΄μ¤)λ¥Ό μ΅°νν•λ‹¤.
- μ• ν”λ¦¬μΌ€μ΄μ… λΉ μ¶λ ¥ν•κΈ°
    - μ¤ν”„λ§μ΄ λ‚΄λ¶€μ—μ„ μ‚¬μ©ν•λ” λΉμ€ μ μ™Έν•κ³ , λ‚΄κ°€ λ“±λ΅ν• λΉλ§ μ¶λ ¥ν•΄λ³΄μ.
    - μ¤ν”„λ§μ΄ λ‚΄λ¶€μ—μ„ μ‚¬μ©ν•λ” λΉμ€ `getRole()` λ΅ κµ¬λ¶„ν•  μ μλ‹¤.
        - `ROLE_APPLICATION` : μΌλ°μ μΌλ΅ μ‚¬μ©μκ°€ μ •μν• λΉ
        - `ROLE_INFRASTRUCTURE` : μ¤ν”„λ§μ΄ λ‚΄λ¶€μ—μ„ μ‚¬μ©ν•λ” λΉ

&nbsp;

## μ¤ν”„λ§ λΉ μ΅°ν - κΈ°λ³Έ

- μ¤ν”„λ§ μ»¨ν…μ΄λ„μ—μ„ μ¤ν”„λ§ λΉμ„ μ°Ύλ” κ°€μ¥ κΈ°λ³Έμ μΈ μ΅°ν λ°©λ²•
- `ac.getBean(λΉμ΄λ¦„, νƒ€μ…)`
- `ac.getBean(νƒ€μ…)`
- μ΅°ν λ€μƒ μ¤ν”„λ§ λΉμ΄ μ—†μΌλ©΄ μμ™Έ λ°μƒ
    - `NoSuchBeanDefinitionException: No bean named 'xxxxx' available`

**μμ  μ½”λ“**

```java
public class ApplicationContextBasicFindTest {

    AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

    @Test
    @DisplayName("λΉ μ΄λ¦„μΌλ΅ μ΅°ν")
    void findBeanByName() {
        MemberService memberService = ac.getBean("memberService", MemberService.class);
        assertThat(memberService).isInstanceOf(MemberServiceImpl.class);
    }

    @Test
    @DisplayName("μ΄λ¦„ μ—†μ΄ λΉ νƒ€μ…μΌλ΅ μ΅°ν")
    void findBeanByType() {
        MemberService memberService = ac.getBean(MemberService.class);
        assertThat(memberService).isInstanceOf(MemberServiceImpl.class);
    }

    @Test
    @DisplayName("λΉ μ΄λ¦„μΌλ΅ μ΅°νX")
    void findBeanByNameX() {
        assertThrows(NoSuchBeanDefinitionException.class, () -> ac.getBean("xxxxx", MemberService.class));
    }
}
```

&nbsp;

## μ¤ν”„λ§ λΉ μ΅°ν - λ™μΌν• νƒ€μ…μ΄ λ‘ μ΄μƒ

- νƒ€μ…μΌλ΅ μ΅°νμ‹ κ°™μ€ νƒ€μ…μ μ¤ν”„λ§ λΉμ΄ λ‘ μ΄μƒμ΄λ©΄ μ¤λ¥κ°€ λ°μƒν•λ‹¤. μ΄λ•λ” λΉ μ΄λ¦„μ„ μ§€μ •ν•μ.
- `ac.getBeansOfType()` μ„ μ‚¬μ©ν•λ©΄ ν•΄λ‹Ή νƒ€μ…μ λ¨λ“  λΉμ„ μ΅°νν•  μ μλ‹¤.

```java
public class ApplicationContextSameBeanFindTest {

    AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(SameBeanConfig.class);

    @Test
    @DisplayName("νƒ€μ…μΌλ΅ μ΅°νμ‹ κ°™μ€ νƒ€μ…μ΄ λ‘ κ° μ΄μƒ μμΌλ©΄, μ¤‘λ³µ μ¤λ¥κ°€ λ°μƒν•λ‹¤")
    void findBeanByTypeDuplicate() {
        assertThrows(NoUniqueBeanDefinitionException.class,
                () -> ac.getBean(MemberRepository.class));
    }

    @Test
    @DisplayName("νƒ€μ…μΌλ΅ μ΅°νμ‹ κ°™μ€ νƒ€μ…μ΄ λ‘ κ° μ΄μƒ μμΌλ©΄, λΉ μ΄λ¦„μ„ μ§€μ •ν•λ©΄ λλ‹¤")
    void findBeanByName() {
        MemberRepository memberRepository1 = ac.getBean("memberRepository1", MemberRepository.class);
        assertThat(memberRepository1).isInstanceOf(MemberRepository.class);
    }

    @Test
    @DisplayName("νΉμ • νƒ€μ…μ λΉ λ¨λ‘ μ΅°ν ν•κΈ°")
    void findAllBeanByType() {
        Map<String, MemberRepository> beansOfType = ac.getBeansOfType(MemberRepository.class);
        for (String beanName : beansOfType.keySet()) {
            System.out.println("key = " + beanName + ", value = " + beansOfType.get(beanName));
        }
        assertThat(beansOfType.size()).isEqualTo(2);
    }

    @Configuration
    static class SameBeanConfig {

        @Bean
        public MemberRepository memberRepository1() {
            return new MemoryMemberRepository();
        }

        @Bean
        public MemberRepository memberRepository2() {
            return new MemoryMemberRepository();
        }
    }
}
```

&nbsp;

