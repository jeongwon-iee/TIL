# π± μ¤ν”„λ§ ν•µμ‹¬ μ›λ¦¬ μ΄ν•΄ 2 - κ°μ²΄ μ§€ν–¥ μ›λ¦¬ μ μ©

## μƒλ΅μ΄ ν• μΈ μ •μ±… κ°λ°

### μƒλ΅μ΄ ν• μΈ μ •μ±… ν™•μ¥

**μ•…λ• κΈ°νμ**: μ„λΉ„μ¤ μ¤ν” μ§μ „μ— ν• μΈ μ •μ±…μ„ μ§€κΈμ²λΌ κ³ μ • κΈμ•΅ ν• μΈμ΄ μ•„λ‹λΌ μΆ€ λ” ν•©λ¦¬μ μΈ μ£Όλ¬Έ κΈμ•΅λ‹Ή ν• μΈν•λ” μ •λ¥ (%) ν• μΈμΌλ΅ λ³€κ²½ν•κ³  μ‹¶μ–΄μ”. μλ¥Ό λ“¤μ–΄μ„ κΈ°μ΅΄ μ •μ±…μ€ VIPκ°€ 10000μ›μ„ μ£Όλ¬Έν•λ“  20000μ›μ„ μ£Όλ¬Έν•λ“  ν•­μƒ 1000μ›μ„ ν• μΈν–λ”λ°, μ΄λ²μ— μƒλ΅ λ‚μ¨ μ •μ±…μ€ 10%λ΅ μ§€μ •ν•΄λ‘λ©΄ κ³ κ°μ΄ 10000μ› μ£Όλ¬Έμ‹ 1000μ›μ„ ν• μΈν•΄μ£Όκ³ , 20000μ› μ£Όλ¬Έμ‹μ— 2000μ›μ„ ν• μΈν•΄μ£Όλ” κ±°μ—μ”!

**μμ§„ κ°λ°μ**: μ κ°€ μ²μλ¶€ν„° κ³ μ • κΈμ•΅ ν• μΈμ€ μ•„λ‹λΌκ³  ν–μ–μ•„μ”.

**μ•…λ• κΈ°νμ**: μ• μμΌ μ†ν”„νΈμ›¨μ–΄ κ°λ° μ„ μ–Έ λ°λΌμ”? β€**κ³„νμ„ λ”°λ¥΄κΈ°λ³΄λ‹¤ λ³€ν™”μ— λ€μ‘ν•κΈ°λ¥Ό**β€

**μμ§„ κ°λ°μ**: ... (ν•μ§€λ§ λ‚ μ μ—°ν• μ„¤κ³„κ°€ κ°€λ¥ν•λ„λ΅ κ°μ²΄μ§€ν–¥ μ„¤κ³„ μ›μΉ™μ„ μ¤€μν–μ§€ ν›„ν›„)

μ°Έκ³ : μ• μμΌ μ†ν”„νΈμ›¨μ–΄ κ°λ° μ„ μ–Έ [https://agilemanifesto.org/iso/ko/manifesto.html](https://agilemanifesto.org/iso/ko/manifesto.html)

β†’ κ°λ°μκ°€ μ •λ§ κ°μ²΄μ§€ν–¥ μ„¤κ³„ μ›μΉ™μ„ μ μ¤€μν–λ”μ§€ ν™•μΈν•΄λ³΄μ. μ΄λ²μ—λ” μ£Όλ¬Έν• κΈμ•΅μ %λ¥Ό ν• μΈν•΄μ£Όλ” μƒλ΅μ΄ μ •λ¥  ν• μΈ μ •μ±…μ„ μ¶”κ°€ν•΄λ³΄μ.

### `RateDiscountPolicy` μ¶”κ°€

<img width="834" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2021-02-25 α„‹α…©α„’α…® 4 07 00" src="https://user-images.githubusercontent.com/45806836/109116201-7eff1700-7783-11eb-828b-6dbe84c2c909.png">

```java
public class RateDiscountPolicy implements DiscountPolicy {

    private int discountPercent = 10;

    @Override
    public int discount(Member member, int price) {
        if (member.getGrade() == Grade.VIP) {
            return price * discountPercent / 100;
        } else {
            return 0;
        }
    }
}
```

μ„±κ³µ **ν…μ¤νΈ μ‘μ„±** 

```java
class RateDiscountPolicyTest {

    RateDiscountPolicy rateDiscountPolicy = new RateDiscountPolicy();

    @Test
    @DisplayName("VIPλ” 10% ν• μΈμ΄ μ μ©λμ–΄μ•Ό ν•λ‹¤.")
    void discount() {
        // given
        Member member = new Member(1L, "jeongwon", Grade.VIP);

        // when
        int discount = rateDiscountPolicy.discount(member, 10000);

        // then
        Assertions.assertThat(discount).isEqualTo(1000);
    }
}
```

**μ‹¤ν¨ ν…μ¤νΈ μ‘μ„±**

```java
@Test
@DisplayName("VIPκ°€ μ•„λ‹λ©΄ ν• μΈμ΄ μ μ©λμ§€ μ•μ•„μ•Ό ν•λ‹¤.")
void noDiscount() {
    // given
    Member member = new Member(1L, "jeongwon", Grade.BASIC);

    // when
    int discount = rateDiscountPolicy.discount(member, 10000);

    // then
    assertThat(discount).isEqualTo(0);
}
```

&nbsp;

## μƒλ΅μ΄ ν• μΈ μ •μ±… μ μ©κ³Ό λ¬Έμ μ 

λ°©κΈ μ¶”κ°€ν• ν• μΈ μ •μ±…μ„ μ μ©ν•΄λ³΄μ.

*ν• μΈ μ •μ±…μ„ λ³€κ²½ν•λ ¤λ©΄ ν΄λΌμ΄μ–ΈνΈμΈ `OrderServiceImpl` μ½”λ“λ¥Ό κ³ μ³μ•Ό ν•λ‹¤.*

```java
public class OrderServiceImpl implements OrderService {

    private final MemberRepository memberRepository = new MemoryMemberRepository();
    //    private final DiscountPolicy discountPolicy = new FixDiscountPolicy();
    private final DiscountPolicy discountPolicy = new RateDiscountPolicy();
		...
}
```

### λ¬Έμ μ 

- μ—­ν• κ³Ό κµ¬ν„μ„ μ¶©μ‹¤ν•κ² λ¶„λ¦¬ν–λ‹¤. β†’ OK
- λ‹¤ν•μ„±λ„ ν™μ©ν•κ³ , μΈν„°νμ΄μ¤μ™€ κµ¬ν„ κ°μ²΄λ¥Ό λ¶„λ¦¬ν–λ‹¤. β†’ OK
- OCP, DIP κ°™μ€ κ°μ²΄μ§€ν–¥ μ„¤κ³„ μ›μΉ™μ„ μ¶©μ‹¤ν μ¤€μν–λ‹¤.

    β†’ κ·Έλ ‡κ² λ³΄μ΄μ§€λ§ μ‚¬μ‹¤μ€ μ•„λ‹λ‹¤.

- DIP: μ£Όλ¬Έμ„λΉ„μ¤ ν΄λΌμ΄μ–ΈνΈ( `OrderServiceImpl` )λ” `DiscountPolicy` μΈν„°νμ΄μ¤μ— μμ΅΄ν•λ©΄μ„ DIPλ¥Ό μ§€ν‚¨ κ²ƒ κ°™μ€λ°?

    β†’ ν΄λμ¤ μμ΅΄κ΄€κ³„λ¥Ό λ¶„μ„ν•΄ λ³΄μ. μ¶”μƒ(μΈν„°νμ΄μ¤) λΏλ§ μ•„λ‹λΌ **κµ¬μ²΄(κµ¬ν„) ν΄λμ¤μ—λ„ μμ΅΄**ν•κ³  μλ‹¤.  
    μ¶”μƒ(μΈν„°νμ΄μ¤) μμ΅΄: `DiscountPolicy`
    κµ¬μ²΄(κµ¬ν„) ν΄λμ¤: `FixDiscountPolicy` , `RateDiscountPolicy`

- OCP: λ³€κ²½ν•μ§€ μ•κ³  ν™•μ¥ν•  μ μλ‹¤κ³  ν–λ”λ°!
    - **μ§€κΈ μ½”λ“λ” κΈ°λ¥μ„ ν™•μ¥ν•΄μ„ λ³€κ²½ν•λ©΄, ν΄λΌμ΄μ–ΈνΈ μ½”λ“μ— μν–¥μ„ μ¤€λ‹¤!** λ”°λΌμ„ **OCPλ¥Ό μ„λ°**ν•λ‹¤.

**κΈ°λ€ν–λ μμ΅΄ κ΄€κ³„**


<img width="834" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2021-02-25 α„‹α…©α„’α…® 4 29 37" src="https://user-images.githubusercontent.com/45806836/109118431-a99e9f00-7786-11eb-928b-f7ca070bab66.png">

μ§€κΈκΉμ§€ λ‹¨μν `DiscountPolicy` μΈν„°νμ΄μ¤λ§ μμ΅΄ν•λ‹¤κ³  μƒκ°ν–λ‹¤.

**μ‹¤μ  μμ΅΄ κ΄€κ³„**


<img width="834" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2021-02-25 α„‹α…©α„’α…® 4 29 59" src="https://user-images.githubusercontent.com/45806836/109118479-b7542480-7786-11eb-8a61-5e88f435c950.png">

`OrderServiceImpl` μ΄ `DiscountPolicy` μΈν„°νμ΄μ¤ λΏλ§ μ•„λ‹λΌ `FixDiscountPolicy` μΈ κµ¬μ²΄ ν΄λμ¤λ„ ν•¨κ» μμ΅΄ν•κ³  μλ‹¤. β†’ ***DIP (κµ¬μ²΄ν™” λ§κ³  μ¶”μƒν™”μ— μμ΅΄ν•λΌ) μ„λ°***


<img width="833" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2021-02-25 α„‹α…©α„’α…® 4 32 09" src="https://user-images.githubusercontent.com/45806836/109118718-04d09180-7787-11eb-8faa-786fcba5e73b.png">

***μ¤‘μ”!***: κ·Έλμ„ `FixDiscountPolicy` λ¥Ό `RateDiscountPolicy` λ΅ λ³€κ²½ν•λ” μκ°„ `OrderServiceImpl` μ μ†μ¤ μ½”λ“λ„ ν•¨κ» λ³€κ²½ν•΄μ•Ό ν•λ‹¤! β†’ ***OCP μ„λ°***

### λ¬Έμ μ ν•΄κ²°

- ν΄λΌμ΄μ–ΈνΈ μ½”λ“μΈ `OrderServiceImpl` μ€ `DiscountPolicy` μ μΈν„°νμ΄μ¤ λΏλ§ μ•„λ‹λΌ κµ¬μ²΄ ν΄λμ¤λ„ ν•¨κ» μμ΅΄ν•λ‹¤.
- κ·Έλμ„ κµ¬μ²΄ ν΄λμ¤λ¥Ό λ³€κ²½ν•  λ• ν΄λΌμ΄μ–ΈνΈ μ½”λ“λ„ ν•¨κ» λ³€κ²½ν•΄μ•Ό ν•λ‹¤.
- **DIP μ„λ° β†’** μ¶”μƒμ—λ§ μμ΅΄ν•λ„λ΅ λ³€κ²½ (μΈν„°νμ΄μ¤μ—λ§ μμ΅΄)
- DIPλ¥Ό μ„λ°ν•μ§€ μ•λ„λ΅ μΈν„°νμ΄μ¤μ—λ§ μμ΅΄ν•λ„λ΅ μμ΅΄κ΄€κ³„λ¥Ό λ³€κ²½ν•λ©΄ λλ‹¤.

**μΈν„°νμ΄μ¤μ—λ§ μμ΅΄ν•λ„λ΅ μ„¤κ³„λ¥Ό λ³€κ²½ν•μ**


<img width="834" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2021-02-25 α„‹α…©α„’α…® 4 36 30" src="https://user-images.githubusercontent.com/45806836/109119147-9fc96b80-7787-11eb-8fd9-5d9e48385d5c.png">

```java
public class OrderServiceImpl implements OrderService {

    private final MemberRepository memberRepository = new MemoryMemberRepository();
    private DiscountPolicy discountPolicy;
		...
}
```

μΈν„°νμ΄μ¤μ—λ§ μμ΅΄ν•λ„λ΅ μ„¤κ³„μ™€ μ½”λ“λ¥Ό λ³€κ²½ν–λ‹¤.  
**κ·Έλ°λ° κµ¬ν„μ²΄κ°€ μ—†λ”λ° μ–΄λ–»κ² μ½”λ“λ¥Ό μ‹¤ν–‰ν•  μ μμ„κΉ?  
β†’** μ‹¤μ  μ‹¤ν–‰μ„ ν•΄λ³΄λ©΄ *NPE(null pointer exception)*κ°€ λ°μƒν•λ‹¤.

**ν•΄κ²° λ°©μ•**

λ„κµ°κ°€ ν΄λΌμ΄μ–ΈνΈμΈ `OrderServiceImpl` μ— `DiscountPolicy` μ κµ¬ν„ κ°μ²΄λ¥Ό λ€μ‹  μƒμ„±, μ£Όμ…ν•΄μ¤μ•Ό ν•λ‹¤.

&nbsp;

## κ΄€μ‹¬μ‚¬μ λ¶„λ¦¬

- μ• ν”λ¦¬μΌ€μ΄μ…μ„ ν•λ‚μ κ³µμ—°μ΄λΌ μƒκ°ν•΄λ³΄μ. κ°κ°μ μΈν„°νμ΄μ¤λ¥Ό λ°°μ—­(λ°°μ° μ—­ν• )μ΄λΌ μƒκ°ν•μ. κ·Έλ°λ°!
μ‹¤μ  λ°°μ—­ λ§λ” λ°°μ°λ¥Ό μ„ νƒν•λ” κ²ƒμ€ λ„κ°€ ν•λ”κ°€?
- λ΅λ―Έμ¤μ™€ μ¤„λ¦¬μ—£ κ³µμ—°μ„ ν•λ©΄ λ΅λ―Έμ¤ μ—­ν• μ„ λ„κ°€ ν• μ§€ μ¤„λ¦¬μ—£ μ—­ν• μ„ λ„κ°€ ν• μ§€λ” λ°°μ°λ“¤μ΄ μ •ν•λ”κ² μ•„λ‹λ‹¤. μ΄μ „ μ½”λ“λ” λ§μΉ λ΅λ―Έμ¤ μ—­ν• (μΈν„°νμ΄μ¤)μ„ ν•λ” λ μ¤λ‚λ¥΄λ„ λ””μΉ΄ν”„λ¦¬μ¤(κµ¬ν„μ²΄, λ°°μ°)κ°€ μ¤„λ¦¬μ—£ μ—­ν•  (μΈν„°νμ΄μ¤)μ„ ν•λ” μ—¬μ μ£ΌμΈκ³µ(κµ¬ν„μ²΄, λ°°μ°)μ„ μ§μ ‘ μ΄λΉ™ν•λ” κ²ƒκ³Ό κ°™λ‹¤. λ””μΉ΄ν”„λ¦¬μ¤λ” κ³µμ—°λ„ ν•΄μ•Όν•κ³  λ™μ‹μ— μ—¬μ μ£ΌμΈκ³µλ„ κ³µμ—°μ— μ§μ ‘ μ΄λΉ™ν•΄μ•Ό ν•λ” **λ‹¤μ–‘ν• μ±…μ„**μ„ κ°€μ§€κ³  μλ‹¤.

    ```java
    private final DiscountPolicy discountPolicy = new FixDiscountPolicy();
    ```

### κ΄€μ‹¬μ‚¬λ¥Ό λ¶„λ¦¬ν•μ

- λ°°μ°λ” λ³ΈμΈμ μ—­ν• μΈ λ°°μ—­μ„ μν–‰ν•λ” κ²ƒμ—λ§ μ§‘μ¤‘ν•΄μ•Ό ν•λ‹¤.
- λ””μΉ΄ν”„λ¦¬μ¤λ” μ–΄λ–¤ μ—¬μ μ£ΌμΈκ³µμ΄ μ„ νƒλλ”λΌλ„ λ‘κ°™μ΄ κ³µμ—°μ„ ν•  μ μμ–΄μ•Ό ν•λ‹¤.
- κ³µμ—°μ„ κµ¬μ„±ν•κ³ , λ‹΄λ‹Ή λ°°μ°λ¥Ό μ„­μ™Έν•κ³ , μ—­ν• μ— λ§λ” λ°°μ°λ¥Ό μ§€μ •ν•λ” μ±…μ„μ„ λ‹΄λ‹Ήν•λ” λ³„λ„μ **κ³µμ—° κΈ°νμ**κ°€ λ‚μ¬μ‹μ μ΄λ‹¤.
- κ³µμ—° κΈ°νμλ¥Ό λ§λ“¤κ³ , λ°°μ°μ™€ κ³µμ—° κΈ°νμμ μ±…μ„μ„ ν™•μ‹¤ν λ¶„λ¦¬ν•μ.

### AppConfig λ“±μ¥

μ• ν”λ¦¬μΌ€μ΄μ…μ μ „μ²΄ λ™μ‘ λ°©μ‹μ„ κµ¬μ„±(config)ν•κΈ° μ„ν•΄, **κµ¬ν„ κ°μ²΄λ¥Ό μƒμ„±**ν•κ³ , **μ—°κ²°**ν•λ” μ±…μ„μ„ κ°€μ§€λ” λ³„λ„μ μ„¤μ • ν΄λμ¤λ¥Ό λ§λ“¤μ.

`**AppConfig`: μ• ν”λ¦¬μΌ€μ΄μ… μ „λ°μ— λ€ν• μ΄μμ„ μ„¤μ •ν•κ³  κµ¬μƒ**

```java
public class AppConfig {

    public MemberService memberService() {
        return new MemberServiceImpl(new MemoryMemberRepository());
    }

    public OrderService orderService() {
        return new OrderServiceImpl(new MemoryMemberRepository(), new RateDiscountPolicy());
    }

}
```

- `AppConfig`λ” μ• ν”λ¦¬μΌ€μ΄μ…μ μ‹¤μ  λ™μ‘μ— ν•„μ”ν• **κµ¬ν„ κ°μ²΄λ¥Ό μƒμ„±**ν•λ‹¤.
    - `MemberServiceImpl`
    - `MemoryMemberRepository`
    - `OrderServiceImpl`
    - `FixDiscountPolicy`
- AppConfigλ” μƒμ„±ν• κ°μ²΄ μΈμ¤ν„΄μ¤μ μ°Έμ΅°(λ νΌλ°μ¤)λ¥Ό **μƒμ„±μλ¥Ό ν†µν•΄μ„ μ£Όμ…(μ—°κ²°)**ν•΄μ¤€λ‹¤.
    - `MemberServiceImpl` β†’ `MemoryMemberRepository`
    - `OrderServiceImpl` β†’ `MemoryMemberRepository` , `FixDiscountPolicy`

`MemberService`κ°€ μƒμ„±λλ©΄ (κµ¬μ²΄μ μΈ `MemberServiceImpl`μ„ μ—¬κΈ°μ„ μ„ νƒ)

- `private final MemberRepository memberRepository = new MemoryMemberRepository();`   `MemberRepository`κµ¬ν„μ²΄λ¥Ό ν΄λΌμ΄μ–ΈνΈμΈ `MemberServiceImpl`μ΄ μ§μ ‘ μ„¤μ • (λ°°μ°κ°€ μ§μ ‘ λ°°μ° μ„­μ™Έ)
- `MemberServiceImpl`(ν΄λΌμ΄μ–ΈνΈ)μ—μ„ μ§μ ‘ μƒμ„±ν•΄ ν• λ‹Ήν•΄μ£Όλ `MemoryMemberRepository` λ€μ‹  μƒμ„±μλ¥Ό ν†µν•΄ `MemberRepository`λ¥Ό μ£Όμ…λ°›κ² ν•¨.(`final` ν•„λ“λ” μƒμ„±μ μ£Όμ… κ°€λ¥) μ£Όμ…μ€ `AppConfig`.

    β†’ `MemberServiceImpl`(ν΄λΌμ΄μ–ΈνΈ)λ” `MemberRepository`(μ¶”μƒν™”)λ§ λ°”λΌλ³΄κ³ , κµ¬ν„μ— λ€ν• λ‚΄μ©X  
      = μ¶”μƒν™”μ—λ§ μμ΅΄, κµ¬μ²΄μ μΈ κ²ƒμ€ λ¨λ¦„. ***μƒμ„±μ μ£Όμ…μ„ ν†µν•΄ DIPλ¥Ό λ§μ΅±*** 

`OrderService`κ°€ μƒμ„±λλ©΄ (κµ¬μ²΄μ μΈ `OrderServiceImpl`μ„ μ—¬κΈ°μ„ μ„ νƒ)

- `private final MemberRepository memberRepository = new MemoryMemberRepository();`   `MemberRepository`κµ¬ν„μ²΄λ¥Ό ν΄λΌμ΄μ–ΈνΈμΈ `OrderServiceImpl`μ΄ μ§μ ‘ μ„¤μ • (λ°°μ°κ°€ μ§μ ‘ λ°°μ° μ„­μ™Έ)
- `private final DiscountPolicy discountPolicy = new RateDiscountPolicy();`  
`DiscountPolicy` κµ¬ν„μ²΄λ¥Ό ν΄λΌμ΄μ–ΈνΈμΈ `OrderServiceImpl`μ΄ μ§μ ‘ μ„¤μ •
- `OrderServiceImpl`(ν΄λΌμ΄μ–ΈνΈ)μ—μ„ μ§μ ‘ μƒμ„±ν•΄ ν• λ‹Ήν•΄μ£Όλ `MemoryMemberRepository`, `RateDiscountPolicy` λ€μ‹  μƒμ„±μλ¥Ό ν†µν•΄ `MemberRepository`, `DiscountPolicy`λ¥Ό μ£Όμ…λ°›κ² ν•¨.

    β†’ `OrderServiceImpl`(ν΄λΌμ΄μ–ΈνΈ)λ” μ¶”μƒν™”λ§ λ°”λΌλ³΄κ³ , κµ¬ν„μ— λ€ν• λ‚΄μ©μ€ λ¨λ¦„ ***DIP λ§μ΅±***

**`MemberServiceImpl` μƒμ„±μ μ£Όμ…**

```java
public class MemberServiceImpl implements MemberService {

    private final MemberRepository memberRepository;

    public MemberServiceImpl(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }
		...
}
```

- μ„¤κ³„ λ³€κ²½μΌλ΅ `MemberServiceImpl` μ€ `MemoryMemberRepository` λ¥Ό μμ΅΄ν•μ§€ μ•λ”λ‹¤!
    - λ‹¨μ§€ `MemberRepository` μΈν„°νμ΄μ¤λ§ μμ΅΄ν•λ‹¤. ***DIP λ§μ΅±***
- `MemberServiceImpl` μ…μ¥μ—μ„ μƒμ„±μλ¥Ό ν†µν•΄ μ–΄λ–¤ κµ¬ν„ κ°μ²΄κ°€ λ“¤μ–΄μ¬μ§€(μ£Όμ… λ  μ§€)λ” μ• μ μ—†λ‹¤.
- `MemberServiceImpl` μ μƒμ„±μλ¥Ό ν†µν•΄μ„ μ–΄λ–¤ κµ¬ν„ κ°μ²΄λ¥Ό μ£Όμ…ν• μ§€λ” μ¤μ§ μ™Έλ¶€( `AppConfig` )μ—μ„ κ²°μ •λλ‹¤.
- `MemberServiceImpl` μ€ μ΄μ λ¶€ν„° **μμ΅΄κ΄€κ³„μ— λ€ν• κ³ λ―Όμ€ μ™Έλ¶€**μ— λ§΅κΈ°κ³  **μ‹¤ν–‰μ—λ§ μ§‘μ¤‘**ν•λ©΄ λλ‹¤.

**ν΄λμ¤ λ‹¤μ΄μ–΄κ·Έλ¨**


<img width="836" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2021-02-25 α„‹α…©α„’α…® 6 32 09" src="https://user-images.githubusercontent.com/45806836/109132959-c7c0cb00-7797-11eb-8e06-419d4b7542f6.png">

- κ°μ²΄μ μƒμ„±κ³Ό μ—°κ²°μ€ `AppConfig` κ°€ λ‹΄λ‹Ήν•λ‹¤.
- **DIP μ™„μ„±:** `MemberServiceImpl` μ€ `MemberRepository` μΈ μ¶”μƒμ—λ§ μμ΅΄ν•λ©΄ λλ‹¤. μ΄μ  κµ¬μ²΄ ν΄λμ¤λ¥Ό λ°λΌλ„ λλ‹¤.
- **κ΄€μ‹¬μ‚¬μ λ¶„λ¦¬:** κ°μ²΄λ¥Ό μƒμ„±ν•κ³  μ—°κ²°ν•λ” μ—­ν• κ³Ό μ‹¤ν–‰ν•λ” μ—­ν• μ΄ λ…ν™•ν λ¶„λ¦¬λμ—λ‹¤.
- `appConfig` κ°μ²΄λ” `memoryMemberRepository` κ°μ²΄λ¥Ό μƒμ„±ν•κ³  κ·Έ μ°Έμ΅°κ°’μ„ `memberServiceImpl` μ„ μƒμ„±ν•λ©΄μ„ μƒμ„±μλ΅ μ „λ‹¬ν•λ‹¤.
- ν΄λΌμ΄μ–ΈνΈμΈ `memberServiceImpl` μ…μ¥μ—μ„ λ³΄λ©΄ μμ΅΄κ΄€κ³„λ¥Ό λ§μΉ μ™Έλ¶€μ—μ„ μ£Όμ…ν•΄μ£Όλ” κ²ƒ κ°™λ‹¤κ³  ν•΄μ„
***DI(Dependency Injection)*** μ°λ¦¬λ§λ΅ ***μμ΅΄κ΄€κ³„ μ£Όμ…*** λλ” ***μμ΅΄μ„± μ£Όμ…*** μ΄λΌ ν•λ‹¤.

**`OrderServiceImpl` μƒμ„±μ μ£Όμ…**

```java
public class OrderServiceImpl implements OrderService {

    private final MemberRepository memberRepository;
    private final DiscountPolicy discountPolicy;

    public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy discountPolicy) {
        this.memberRepository = memberRepository;
        this.discountPolicy = discountPolicy;
    }
		...
}
```

- μ„¤κ³„ λ³€κ²½μΌλ΅ `OrderServiceImpl` μ€ `FixDiscountPolicy` λ¥Ό μμ΅΄ν•μ§€ μ•λ”λ‹¤!
    - λ‹¨μ§€ `DiscountPolicy` μΈν„°νμ΄μ¤λ§ μμ΅΄ν•λ‹¤. ***DIP λ§μ΅±***
- `OrderServiceImpl` μ…μ¥μ—μ„ μƒμ„±μλ¥Ό ν†µν•΄ μ–΄λ–¤ κµ¬ν„ κ°μ²΄κ°€ λ“¤μ–΄μ¬μ§€(μ£Όμ…λ μ§€)λ” μ• μ μ—†λ‹¤.
- `OrderServiceImpl` μ μƒμ„±μλ¥Ό ν†µν•΄μ„ μ–΄λ–¤ κµ¬ν„ κ°μ²΄μ„ μ£Όμ…ν• μ§€λ” μ¤μ§ μ™Έλ¶€( `AppConfig` )μ—μ„ κ²°μ •
ν•λ‹¤.
- `OrderServiceImpl` μ€ μ΄μ λ¶€ν„° μ‹¤ν–‰μ—λ§ μ§‘μ¤‘ν•λ©΄ λλ‹¤.
- `OrderServiceImpl`μ—λ” `MemoryMemberRepository`, `FixDiscountPolicy`κ°μ²΄μ μμ΅΄κ΄€κ³„κ°€ μ£Όμ…λλ‹¤.

### AppConfig μ‹¤ν–‰

**μ‚¬μ© ν΄λμ¤ - MemberApp**

```java
public static void main(String[] args) {
    AppConfig appConfig = new AppConfig();
    MemberService memberService = appConfig.memberService();
		...
}
```

**μ‚¬μ© ν΄λμ¤ - OrderApp**

```java
public static void main(String[] args) {
    AppConfig appConfig = new AppConfig();
    MemberService memberService = appConfig.memberService();
    OrderService orderService = appConfig.orderService();
		...
}
```

**ν…μ¤νΈ μ½”λ“ μ¤λ¥ μμ •**

```java
class MemberServiceTest {

    MemberService memberService;

    @BeforeEach
    void beforeEach() {
        AppConfig appConfig = new AppConfig();
        memberService = appConfig.memberService();
    }
		...
}
```

```java
class OrderServiceTest {

    MemberService memberService;
    OrderService orderService;

    @BeforeEach
    void beforeEach() {
        AppConfig appConfig = new AppConfig();
        memberService = appConfig.memberService();
        orderService = appConfig.orderService();
    }
		...
}
```

ν…μ¤νΈ μ½”λ“μ—μ„ `@BeforeEach`λ” κ° ν…μ¤νΈλ¥Ό μ‹¤ν–‰ν•κΈ° μ „μ— νΈμ¶λλ‹¤.

**μ •λ¦¬**

- `AppConfig`λ¥Ό ν†µν•΄μ„ κ΄€μ‹¬μ‚¬λ¥Ό ν™•μ‹¤ν•κ² λ¶„λ¦¬ν–λ‹¤.
- λ°°μ—­, λ°°μ°λ¥Ό μƒκ°ν•΄λ³΄μ.
- `AppConfig`λ” κ³µμ—° κΈ°νμλ‹¤.
- `AppConfig`λ” κµ¬μ²΄ ν΄λμ¤λ¥Ό μ„ νƒν•λ‹¤. λ°°μ—­μ— λ§λ” λ‹΄λ‹Ή λ°°μ°λ¥Ό μ„ νƒν•λ‹¤. μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ–΄λ–»κ² λ™μ‘ν•΄
μ•Ό ν• μ§€ μ „μ²΄ κµ¬μ„±μ„ μ±…μ„μ§„λ‹¤.
- μ΄μ  κ° λ°°μ°λ“¤μ€ λ‹΄λ‹Ή κΈ°λ¥μ„ μ‹¤ν–‰ν•λ” μ±…μ„λ§ μ§€λ©΄ λλ‹¤.
- `OrderServiceImpl` μ€ κΈ°λ¥μ„ μ‹¤ν–‰ν•λ” μ±…μ„λ§ μ§€λ©΄ λλ‹¤.

&nbsp;

## AppConfig λ¦¬ν©ν„°λ§

ν„μ¬ AppConfigλ¥Ό λ³΄λ©΄ **μ¤‘λ³µ**μ΄ μκ³ , **μ—­ν• μ— λ”°λ¥Έ κµ¬ν„**μ΄ μ μ• λ³΄μΈλ‹¤.

**κΈ°λ€ν•λ” κ·Έλ¦Ό**


<img width="833" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2021-02-26 α„‹α…©α„α…¥α†« 9 31 18" src="https://user-images.githubusercontent.com/45806836/109237668-64757e00-7815-11eb-9fd2-bc374eb82d97.png">

**λ¦¬ν©ν„°λ§ μ „**

```java
public class AppConfig {

    public MemberService memberService() {
        return new MemberServiceImpl(new MemoryMemberRepository());
    }

    public OrderService orderService() {
        return new OrderServiceImpl(new MemoryMemberRepository(), new FixDiscountPolicy());
    }

}
```

**λ¦¬ν©ν„°λ§ ν›„**

```java
public class AppConfig {

    public MemberService memberService() {
        return new MemberServiceImpl(MemberRepository());
    }

    private MemberRepository MemberRepository() {
        return new MemoryMemberRepository();
    }

    public OrderService orderService() {
        return new OrderServiceImpl(MemberRepository(), DiscountPolicy());
    }

    private DiscountPolicy DiscountPolicy() {
        return new FixDiscountPolicy();
    }
}
```

`MemoryMemberRepository`μ—μ„ `cmd`,`opt`,`m`μΌλ΅ λ©”μ†λ“ μ¶”μ¶ β†’ `MemberRepository`(μ—­ν• )μ΄ λ“λ¬λ‚¨.

- `new MemoryMemberRepository()` μ΄ λ¶€λ¶„μ΄ μ¤‘λ³µ μ κ±°λμ—λ‹¤. μ΄μ  `MemoryMemberRepository` λ¥Ό λ‹¤λ¥Έ κµ¬ν„μ²΄λ΅ λ³€κ²½ν•  λ• *ν• λ¶€λ¶„λ§ λ³€κ²½ν•λ©΄ λλ‹¤*.
- AppConfig λ¥Ό λ³΄λ©΄ **μ—­ν• (λ©”μ†λ“λ…)**κ³Ό **κµ¬ν„ ν΄λμ¤(λ¦¬ν„΄κ°’)**κ°€ ν•λμ— λ“¤μ–΄μ¨λ‹¤.
- λ©”μ†λ“ λ…μ„ λ³΄λ” μκ°„ μ—­ν• μ΄ λ‹¤ λ“λ¬λ‚λ‹¤.
- μ• ν”λ¦¬μΌ€μ΄μ… μ „μ²΄ κµ¬μ„±μ΄ μ–΄λ–»κ² λμ–΄μλ”μ§€ λΉ λ¥΄κ² νμ•…ν•  μ μλ‹¤.

&nbsp;

## μƒλ΅μ΄ κµ¬μ΅°μ™€ ν• μΈ μ •μ±… μ μ©

- μ²μμΌλ΅ λμ•„κ°€μ„ μ •μ•΅ ν• μΈ μ •μ±…μ„ μ •λ¥ % ν• μΈ μ •μ±…μΌλ΅ λ³€κ²½ν•΄λ³΄μ.
- `FixDiscountPolicy` β†’ `RateDiscountPolicy`
- μ–΄λ–¤ λ¶€λ¶„λ§ λ³€κ²½ν•λ©΄ λκ² λ”κ°€?

`AppConfig`μ λ“±μ¥μΌλ΅ μ• ν”λ¦¬μΌ€μ΄μ…μ΄ ν¬κ² **μ‚¬μ© μμ—­**κ³Ό, **κ°μ²΄λ¥Ό μƒμ„±ν•κ³  κµ¬μ„±(Configuration)ν•λ” μμ—­**μΌλ΅ λ¶„λ¦¬λμ—λ‹¤.

**μ‚¬μ©, κµ¬μ„±μ λ¶„λ¦¬**

<img width="834" alt="α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2021-02-26 α„‹α…©α„α…¥α†« 9 45 15" src="https://user-images.githubusercontent.com/45806836/109238689-57598e80-7817-11eb-8b55-3fee55b27597.png">

- `FixDiscountPolicy` β†’ `RateDiscountPolicy` λ΅ λ³€κ²½ν•΄λ„ κµ¬μ„± μμ—­λ§ μν–¥μ„ λ°›κ³ , μ‚¬μ© μμ—­μ€ μν–¥μ„ λ°›μ§€ μ•λ”λ‹¤.
- `AppConfig` μ—μ„ ν• μΈ μ •μ±… μ—­ν• μ„ λ‹΄λ‹Ήν•λ” κµ¬ν„μ„ `FixDiscountPolicy` β†’ `RateDiscountPolicy` κ°μ²΄λ΅ λ³€κ²½ν–λ‹¤.
- μ΄μ  ν• μΈ μ •μ±…μ„ λ³€κ²½ν•΄λ„, μ• ν”λ¦¬μΌ€μ΄μ…μ κµ¬μ„± μ—­ν• μ„ λ‹΄λ‹Ήν•λ” `AppConfig`λ§ λ³€κ²½ν•λ©΄ λλ‹¤. ν΄λΌμ΄μ–ΈνΈ μ½”λ“μΈ `OrderServiceImpl` λ¥Ό ν¬ν•¨ν•΄μ„ ***μ‚¬μ© μμ—­**μ μ–΄λ–¤ μ½”λ“λ„ λ³€κ²½ν•  ν•„μ”κ°€ μ—†λ‹¤.*
- **κµ¬μ„± μμ—­**μ€ λ‹Ήμ—°ν λ³€κ²½λλ‹¤. κµ¬μ„± μ—­ν• μ„ λ‹΄λ‹Ήν•λ” `AppConfig`λ¥Ό μ• ν”λ¦¬μΌ€μ΄μ…μ΄λΌλ” κ³µμ—°μ κΈ°νμλ΅
μƒκ°ν•μ. κ³µμ—° κΈ°νμλ” κ³µμ—° μ°Έμ—¬μμΈ κµ¬ν„ κ°μ²΄λ“¤μ„ λ¨λ‘ μ•μ•„μ•Ό ν•λ‹¤.

&nbsp;
