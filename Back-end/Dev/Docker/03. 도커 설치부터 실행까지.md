# ğŸ³ 03. ë„ì»¤ ì„¤ì¹˜ë¶€í„° ì‹¤í–‰ê¹Œì§€

> ë„ì»¤ëŠ” ë‹¤ì–‘í•œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì†ì‰½ê²Œ ìƒì„±/ì‚­ì œ í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ê°œë°œí•  ë•Œ ë§ì´ ì‚¬ìš©í•œë‹¤.

&nbsp;

## ë„ì»¤ ì„¤ì¹˜í•˜ê¸°

**Linux**

```bash
$ curl -s https://get.docker.com/ | sudo sh
```

ìë™ìœ¼ë¡œ ìµœì‹ ë²„ì „ì˜ ë„ì»¤ë¥¼ ì„¤ì¹˜

**ì„¤ì¹˜ í™•ì¸**

```bash
$ docker version
Client: Docker Engine - Community
 Cloud integration: 1.0.12
 Version:           20.10.5
 API version:       1.41
 Go version:        go1.13.15
 Git commit:        55c4c88
 Built:             Tue Mar  2 20:13:00 2021
 OS/Arch:           darwin/amd64
 Context:           default
 Experimental:      true

Server: Docker Engine - Community
 Engine:
  Version:          20.10.5
  API version:      1.41 (minimum version 1.12)
  Go version:       go1.13.15
  Git commit:       363e9a8
  Built:            Tue Mar  2 20:15:47 2021
  OS/Arch:          linux/amd64
  Experimental:     false
 containerd:
  Version:          1.4.4
  GitCommit:        05f951a3781f4f2c1911b05e61c160e9c30eaa8e
 runc:
  Version:          1.0.0-rc93
  GitCommit:        12644e614e25b05da6fd08a38ffa0cfe1903fdec
 docker-init:
  Version:          0.19.0
  GitCommit:        de40ad0
```

Docker ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ê°€ ëª¨ë‘ ì„¤ì¹˜ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

<img width="845" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-05-03 á„‹á…©á„’á…® 6 39 24" src="https://open.oss.navercorp.com/storage/user/224/files/e2ec0300-ac3e-11eb-927f-84008a0c0099">

- ëª…ë ¹ì–´ë¥¼ í„°ë¯¸ë„ì— ì…ë ¥í•˜ê³  ì—”í„°ë¥¼ ì¹˜ë©´
- í´ë¼ì´ì–¸íŠ¸ê°€ hostì— ì„¤ì¹˜ëœ docker daemonì— ëª…ë ¹ì–´ ì „ë‹¬
- ê·¸ ê²°ê³¼ë¥¼ í™”ë©´ (client)ì— ë³´ì—¬ì¤Œ.

&nbsp;

## ë„ì»¤ ê¸°ë³¸ ëª…ë ¹ì–´ (run)

### run : ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ëŠ” ëª…ë ¹ì–´

```bash
$ docker run [OPTIONS] IMAGE[:TAG|@DIGEST] [COMMAND] [ARG...]
```


<img width="1230" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-05-03 á„‹á…©á„’á…® 6 42 37" src="https://open.oss.navercorp.com/storage/user/224/files/5726a680-ac3f-11eb-8e8d-23ce576fb2e1">


### ubuntu 20.04 ì»¨í…Œì´ë„ˆ ë§Œë“¤ê¸°

```bash
$ docker run ubuntu:20.04
Unable to find image 'ubuntu:20.04' locally
20.04: Pulling from library/ubuntu
345e3491a907: Pull complete 
57671312ef6f: Pull complete 
5e9250ddb7d0: Pull complete 
Digest: sha256:cf31af331f38d1d7158470e095b132acd126a7180a54f263d386da88eb681d93
Status: Downloaded newer image for ubuntu:20.04
```

- `run` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ì‚¬ìš©í•  ì´ë¯¸ì§€ê°€ ì €ì¥ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³ ,  
ì—†ë‹¤ë©´ ë‹¤ìš´ë¡œë“œ (`pull`)í•œ í›„ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±(`create`)í•˜ê³  ì‹œì‘(`start`)í•œë‹¤.
- ì»¨í…Œì´ë„ˆëŠ” ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ëì§€ë§Œ, ë”ì´ìƒì˜ ëª…ë ¹ì–´ë¥¼ ì „ë‹¬í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ì»¨í…Œì´ë„ˆëŠ” ìƒì„±ë˜ìë§ˆì ì¢…ë£Œëœë‹¤.
- ì»¨í…Œì´ë„ˆëŠ” ê²©ë¦¬ëœ **í”„ë¡œì„¸ìŠ¤**ì´ê¸° ë•Œë¬¸ì— ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ê°€ ì—†ìœ¼ë©´ ì»¨í…Œì´ë„ˆëŠ” ì¢…ë£Œëœë‹¤.

```bash
$ docker run --rm -it ubuntu:20.04 /bin/sh
#
# ls
bin  boot  dev	etc  home  lib	lib32  lib64  libx32  media  mnt  opt  proc  root  run	sbin  srv  sys	tmp  usr  var
#
```

- ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— ë“¤ì–´ê°€ê¸° ìœ„í•´ `sh`ë¥¼ ì‹¤í–‰í•˜ê³  í‚¤ë³´ë“œ ì…ë ¥ì„ ìœ„í•´ `-it`ì˜µì…˜ì„ ì¤¬ë‹¤.
- ì¶”ê°€ì ìœ¼ë¡œ í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œë˜ë©´ ì»¨í…Œì´ë„ˆê°€ ìë™ìœ¼ë¡œ ì‚­ì œë˜ë„ë¡ `--rm` ì˜µì…˜ë„ ì¶”ê°€í–ˆë‹¤.
- `--rm`ì˜µì…˜ì´ ì—†ë‹¤ë©´ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë˜ë”ë¼ë„ ì‚­ì œë˜ì§€ ì•Šê³  ë‚¨ì•„ìˆì–´ ìˆ˜ë™ìœ¼ë¡œ ì‚­ì œí•´ì•¼ í•œë‹¤.

### CentOS ì‹¤í–‰í•˜ê¸°

```bash
$ docker run --rm -it centos:8 /bin/bash
Unable to find image 'centos:8' locally
8: Pulling from library/centos
7a0437f04f83: Pull complete 
Digest: sha256:5528e8b1b1719d34604c87e11dcd1c0a20bedf46e83b5632cdeac91b8c04efc1
Status: Downloaded newer image for centos:8
[root@56ce8a62f596 /]# ls
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
[root@56ce8a62f596 /]#
```

- ë„ì»¤ëŠ” ë‹¤ì–‘í•œ ë¦¬ëˆ…ìŠ¤ ë°°í¬íŒì„ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.
- ê³µí†µì ì€ ëª¨ë‘ ë™ì¼í•œ ì»¤ë„ì„ ì‚¬ìš©í•œë‹¤ëŠ” ì ì´ë‹¤.
- Ubuntu ë˜ëŠ” CentOSì— í¬í•¨ëœ ë‹¤ì–‘í•œ ê¸°ë³¸ ê¸°ëŠ¥ì´ í•„ìš” ì—†ëŠ” ê²½ìš°, ì´ˆì†Œí˜•(5MB) ì´ë¯¸ì§€ì¸ Alpineì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

### ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰í•˜ê¸°

```bash
$ docker run --rm -it -p 5679:5678 hashicorp/http-echo -text="hello world"
Unable to find image 'hashicorp/http-echo:latest' locally
latest: Pulling from hashicorp/http-echo
86399148984b: Pull complete 
Digest: sha256:ba27d460cd1f22a1a4331bdf74f4fccbc025552357e8a3249c40ae216275de96
Status: Downloaded newer image for hashicorp/http-echo:latest
2021/05/03 13:17:41 Server is listening on :5678
2021/05/03 13:18:51 localhost:5678 172.17.0.1:60222 "GET / HTTP/1.1" 200 12 "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36" 31.5Âµs
2021/05/03 13:18:52 localhost:5678 172.17.0.1:60222 "GET /favicon.ico HTTP/1.1" 200 12 "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36" 24.2Âµs
```

- hashicorp/http-echoëŠ” ë¸Œë¼ìš°ì €ë¡œ ì ‘ì†í•˜ë©´ "hello world"ë¥¼ ë¦¬í„´í•´ì£¼ëŠ” ê°€ìƒì˜ ì›¹ ì„œë²„
- `-p`ì˜µì…˜ì„ ì£¼ì–´ localhostì˜ 5679 portê°€ hashicorpì˜ 5678 portì™€ ì—°ê²°ë˜ë„ë¡ í•¨
- ìƒˆ í„°ë¯¸ë„ì„ ë„ì›Œ `curl`(ë¸Œë¼ìš°ì €ì²˜ëŸ¼ httpë¡œ ì ‘ì†í•˜ì—¬ ê²°ê³¼ë¥¼ ë°›ì•„ì˜¤ëŠ” ëª…ë ¹ì–´)ë¡œ `localhost:5678`ì— ì ‘ì†í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ "hello world"ë¥¼ ë°˜í™˜í•œë‹¤.

    ```bash
    $ curl localhost:5678
    hello world
    ```

- ì—¬ëŸ¬ ê°œì˜ hashicorp/http-echo ì›¹ì„œë²„(ì»¨í…Œì´ë„ˆ)ë¥¼ ë„ì›Œ ê²©ë¦¬ëœ ìƒíƒœë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.

### Redis ì‹¤í–‰í•˜ê¸°

```bash
$ docker run --rm -p 1234:6379 redis
Unable to find image 'redis:latest' locally
latest: Pulling from library/redis
f7ec5a41d630: Pull complete 
a36224ca8bbd: Pull complete 
7630ad34dcb2: Pull complete 
c6d2a5632e6c: Pull complete 
f1957981f3c1: Pull complete 
42642d666cff: Pull complete 
Digest: sha256:e10f55f92478715698a2cef97c2bbdc48df2a05081edd884938903aa60df6396
Status: Downloaded newer image for redis:latest
1:C 03 May 2021 13:31:23.539 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
1:C 03 May 2021 13:31:23.539 # Redis version=6.2.2, bits=64, commit=00000000, modified=0, pid=1, just started
1:C 03 May 2021 13:31:23.539 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf
1:M 03 May 2021 13:31:23.540 * monotonic clock: POSIX clock_gettime
1:M 03 May 2021 13:31:23.540 * Running mode=standalone, port=6379.
1:M 03 May 2021 13:31:23.541 # Server initialized
1:M 03 May 2021 13:31:23.541 * Ready to accept connections
```

- ë©”ëª¨ë¦¬ê¸°ë°˜ ë°ì´í„°ë² ì´ìŠ¤ì¸ Redisë¥¼ 1234 portë¡œ ì‹¤í–‰í–ˆë‹¤.
- ì ‘ì† ë°©ë²•

    ```bash
    $ telnet localhost 1234

    set hello world
    +OK
    get hello
    $5
    world
    quit
    ```

- dockerë¥¼ ì´ìš©í•´ ê°œë°œìš©ìœ¼ë¡œ ì—¬ëŸ¬ portì— ì—¬ëŸ¬ redisë¥¼ ë„ì›Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

### MySQL ì‹¤í–‰í•˜ê¸°

```bash
$ docker run -d -p 3306:3306 \
	-e MYSQL_ALLOW_EMPTY_PASSWORD=true \
	--name mysql \
	mysql:5.7

Unable to find image 'mysql:latest' locally
latest: Pulling from library/mysql
f7ec5a41d630: Already exists 
9444bb562699: Pull complete 
6a4207b96940: Pull complete 
181cefd361ce: Pull complete 
8a2090759d8a: Pull complete 
15f235e0d7ee: Pull complete 
d870539cd9db: Pull complete 
493aaa84617a: Pull complete 
bfc0e534fc78: Pull complete 
fae20d253f9d: Pull complete 
9350664305b3: Pull complete 
e47da95a5aab: Pull complete 
Digest: sha256:04ee7141256e83797ea4a84a4d31b1f1bc10111c8d1bc1879d52729ccd19e20a
Status: Downloaded newer image for mysql:latest
3beaa0c5f99536bfbcfc693b086db545f46616aa3dfd38bfda8062dea42dce2d
```

- `-d` ì˜µì…˜ì„ ì£¼ì–´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì„œë²„ë¥¼ ì‹¤í–‰í•˜ë„ë¡ í–ˆë‹¤.
- `--name`ì„  ì´ìš©í•´ ì»¨í…Œì´ë„ˆì— `mysql`ì´ë¼ëŠ” ì´ë¦„ì„ ë¶€ì—¬í–ˆë‹¤.
- ì•„ë˜ì™€ ê°™ì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ë˜ê³  ìˆëŠ” MySQL ì„œë²„ì— ì ‘ì†í•œë‹¤.

    ```bash
    $ docker exec -it mysql mysql
    Welcome to the MySQL monitor.  Commands end with ; or \g.
    Your MySQL connection id is 2
    Server version: 5.7.34 MySQL Community Server (GPL)

    Copyright (c) 2000, 2021, Oracle and/or its affiliates.

    Oracle is a registered trademark of Oracle Corporation and/or its
    affiliates. Other names may be trademarks of their respective
    owners.

    Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

    mysql> create database wp CHARACTER SET utf8;
    Query OK, 1 row affected (0.00 sec)

    mysql> grant all privileges on wp.* to wp@'%' identified by 'wp';
    Query OK, 0 rows affected, 1 warning (0.00 sec)

    mysql> flush privileges;
    Query OK, 0 rows affected (0.00 sec)

    mysql> quit
    Bye
    ```

    - mysqlì´ë€ ì´ë¦„ìœ¼ë¡œ ì ‘ì†í•´ `mysql`ì´ë€ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•œë‹¤.

&nbsp;

### exec ëª…ë ¹ì–´

`exec` ëª…ë ¹ì–´ëŠ” `run` ëª…ë ¹ì–´ì™€ ë‹¬ë¦¬ ì‹¤í–‰ ì¤‘ì¸ ë„ì»¤ ì»¨í…Œì´ë„ˆì— ì ‘ì†í•  ë•Œ ì‚¬ìš©í•˜ë©° ì»¨í…Œì´ë„ˆ ì•ˆì— ssh server ë“±ì„ ì„¤ì¹˜í•˜ì§€ ì•Šê³  exec ëª…ë ¹ì–´ë¡œ ì ‘ì†í•œë‹¤.

- `run`: ìƒˆë¡œ containerë¥¼ ë§Œë“¤ì–´ì„œ ì‹¤í–‰
- `exec`: ì‹¤í–‰ ì¤‘ì¸ containerì— ëª…ë ¹ì–´ ì „ë‹¬

&nbsp;

### ps ëª…ë ¹ì–´

```bash
$ docker ps
CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS                    NAMES
7a5c05434dcb   redis     "docker-entrypoint.sâ€¦"   8 minutes ago   Up 8 minutes   0.0.0.0:1234->6379/tcp   serene_merkle
```

: ì‹¤í–‰ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ëª©ë¡ì„ í™•ì¸í•˜ëŠ” ëª…ë ¹ì–´

```bash
$ docker ps -a
```

ì¤‘ì§€ëœ ì»¨í…Œì´ë„ˆë„ í™•ì¸í•˜ë ¤ë©´ -a ì˜µì…˜ì„ ë¶™ì¸ë‹¤.

&nbsp;

### stop ëª…ë ¹ì–´

```bash
$ docker stop [OPTIONS] CONTAINER [CONTAINER...]
```

ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆë¥¼ ì¤‘ì§€í•˜ëŠ” ëª…ë ¹ì–´

ì‹¤í–‰ì¤‘ì¸ ì»¨í…Œì´ë„ˆë¥¼ í•˜ë‚˜ ë˜ëŠ” ì—¬ëŸ¬ê°œ (ë„ì–´ì“°ê¸°) ì¤‘ì§€í•  ìˆ˜ ìˆë‹¤.

&nbsp;

### rm ëª…ë ¹ì–´

```bash
$ docker rm [OPTIONS] CONTAINER [CONTAINER...]
```

ì¢…ë£Œëœ ì»¨í…Œì´ë„ˆë¥¼ ì™„ì „íˆ ì œê±°í•˜ëŠ” ëª…ë ¹ì–´

&nbsp;

### logs ëª…ë ¹ì–´

```bash
$ docker logs [OPTIONS] CONTAINER
```

ì»¨í…Œì´ë„ˆê°€ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ì¢‹ì€ ë°©ë²•ì€ ë¡œê·¸ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì´ë‹¤.

- `-f` ì˜µì…˜ì„ ì£¼ë©´ ì¶”ê°€ì ì¸ ë¡œê·¸ê°€ ìƒê¸°ëŠ” ê²ƒì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë‹¤.

&nbsp;

### images ëª…ë ¹ì–´

```bash
$ docker images [OPTIONS] [REPOSITORY[:TAG]]
```

ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ë§Œë“  ì»¨í…Œì´ë„ˆë“¤. ì´ë¯¸ì§€ë¥¼ í™•ì¸í•˜ëŠ” ëª…ë ¹ì–´  
(ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì‹œ ì´ë¯¸ì§€ê°€ ì—†ìœ¼ë©´ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ, ìˆë‹¤ë©´ ì´ë¯¸ì§€ë¥¼ ì‹¤í–‰)

&nbsp;

### pull ëª…ë ¹ì–´

```bash
$ docker pull [OPTIONS] NAME[:TAG|@DIGEST]
```

ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œ í•˜ëŠ” ëª…ë ¹ì–´

ex)

```bash
$ docker pull ubuntu:18.04
```

&nbsp;

### rmi ëª…ë ¹ì–´

```bash
$ docker rmi [OPTIONS] IMAGE [IMAGE...]
```

ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ëŠ” ëª…ë ¹ì–´

`images` ëª…ë ¹ì–´ë¥¼ í†µí•´ ì–»ëŠ” ì´ë¯¸ì§€ ëª©ë¡ì—ì„œ {ì´ë¯¸ì§€ ID}ë¥¼ ì…ë ¥í•˜ë©´ ì‚­ì œê°€ ëœë‹¤.

ë‹¨, ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ ì¤‘ì¸ ì´ë¯¸ì§€ëŠ” ì‚­ì œë˜ì§€ ì•ŠëŠ”ë‹¤.

ex)

```bash
$ docker images
REPOSITORY                         TAG           IMAGE ID       CREATED        SIZE
hashicorp/http-echo                latest        a6838e9a6ff6   3 years ago    3.97MB
$ docker rmi d1165f221234
Untagged: hello-world:latest
Untagged: hello-world@sha256:f2266cbfc127c960fd30e76b7c792dc23b588c0db76233517e1891a4e357d519
Deleted: sha256:d1165f2212346b2bab48cb01c1e39ee8ad1be46b87873d9ca7a4e434980a7726
Deleted: sha256:f22b99068db93900abe17f7f5e09ec775c2826ecfe9db961fea68293744144bd
```

&nbsp;

### network create ëª…ë ¹ì–´

```bash
$ docker network create [OPTIONS] NETWORK
```

ë„ì»¤ ì»¨í…Œì´ë„ˆë¼ë¦¬ ì´ë¦„ìœ¼ë¡œ í†µì‹ í•  ìˆ˜ ìˆëŠ” ê°€ìƒ ë„¤íŠ¸ì›Œí¬ë¥¼ ë§Œë“œëŠ” ëª…ë ¹ì–´

- app-network ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ wordpressì™€ mysqlì´ í†µì‹ í•  ë„¤íŠ¸ì›Œí¬ë¥¼ ë§Œë“ ë‹¤.

```bash
$ docker network create app-network
```

- ê¸°ì¡´ì— ìƒì„±ëœ ì»¨í…Œì´ë„ˆ(mysql)ì— ë„¤íŠ¸ì›Œí¬ë¥¼ ì¶”ê°€í•œë‹¤.

```bash
$ docker network connect app-network mysql
```

- ì›Œë“œí”„ë ˆìŠ¤ë¥¼ app-networkì— ì†í•˜ê²Œ í•˜ê³  mysql ì´ë¦„ìœ¼ë¡œ ì ‘ê·¼í•œë‹¤.

```bash
$ docker run -d -p 8080:80 \
  --network=app-network \
  -e WORDPRESS_DB_HOST=mysql \
  -e WORDPRESS_DB_NAME=wp \
  -e WORDPRESS_DB_USER=wp \
  -e WORDPRESS_DB_PASSWORD=wp \
  wordpress
```

&nbsp;

### volume mount (-v) ëª…ë ¹ì–´

- ì‹¤í–‰ ì¤‘ì¸ mysql ì»¨í…Œì´ë„ˆë¥¼ `stop`, `rm`(ì‚­ì œ) í•œ í›„ ë‹¤ì‹œ ì‹¤í–‰í•˜ë‹ˆ ê¸°ì¡´ì˜ dataê°€ ëª¨ë‘ ë‚ ë¼ê°€ ë°ì´í„°ë² ì´ìŠ¤ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.

```bash
$ docker ps
CONTAINER ID   IMAGE       COMMAND                  CREATED          STATUS          PORTS                               NAMES
649084f32c43   wordpress   "docker-entrypoint.sâ€¦"   4 minutes ago    Up 4 minutes    0.0.0.0:8080->80/tcp                ecstatic_swanson
9ad71621c981   mysql:5.7   "docker-entrypoint.sâ€¦"   19 minutes ago   Up 19 minutes   0.0.0.0:3306->3306/tcp, 33060/tcp   mysql

$ docker stop 9ad71621c981

$ docker rm 9ad71621c981

$ docker run -d -p 3306:3306 \
        -e MYSQL_ALLOW_EMPTY_PASSWORD=true \
        --name mysql \
        mysql:5.7
```

- `-v` ì˜µì…˜ì„ ì´ìš©í•´ ì»¨í…Œì´ë„ˆ ë””ë ‰í„°ë¦¬:í˜¸ìŠ¤íŠ¸ë””ë ‰í„°ë¦¬(ì ˆëŒ€ ê²½ë¡œ)ë¥¼ ì—°ê²°í•œë‹¤.

```bash
$ docker stop mysql
$ docker rm mysql
$ docker run -d -p 3306:3306 \
  -e MYSQL_ALLOW_EMPTY_PASSWORD=true \
  --network=app-network \
  --name mysql \
  -v ~/mysql:/var/lib/mysql \
  mysql:5.7
```

 ì´í›„ mysql ì»¨í…Œì´ë„ˆë¥¼ ì‚­ì œ í›„ ì¬ ì‹¤í–‰ í•˜ì—¬ë„ ê¸°ì¡´ì˜ dataê°€ ì €ì¥ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ

&nbsp;

## ë„ì»¤ ì»´í¬ì¦ˆ (docker-compose)

ë„ì»¤ ì»´í¬ì¦ˆë¥¼ ì´ìš©í•˜ë©´ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ì— í•„ìš”í•œ ì˜µì…˜ì„ `docker-compose.yml`ì´ë¼ëŠ” íŒŒì¼ì— ì ì–´ë‘˜ ìˆ˜ìˆê³ , ì»¨í…Œì´ë„ˆ ê°„ ì‹¤í–‰ ìˆœì„œë‚˜ ì˜ì¡´ì„±ë„ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

docker-composeë¥¼ í†µí•´ `docker` ëª…ë ¹ì–´ë¡œ í•œ ë•€ í•œ ë•€ ì…ë ¥í•˜ëŠ” ê²ƒë³´ë‹¤ ì†ì‰½ê²Œ ì»¨í…Œì´ë„ˆë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

Docker for Macì„ ì„¤ì¹˜í•˜ë©´ ìë™ìœ¼ë¡œ docker-composeê°€ ì„¤ì¹˜ ëœë‹¤.

```bash
$ docker-compose version
docker-compose version 1.29.0, build 07737305
docker-py version: 5.0.0
CPython version: 3.9.0
OpenSSL version: OpenSSL 1.1.1h  22 Sep 2020
```

**docker-compose.yml**

```yaml
version: '2'
services:
  db:
    image: mysql:5.7
    volumes:
      - ./mysql:/var/lib/mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: wordpress
      MYSQL_DATABASE: wordpress
      MYSQL_USER: wordpress
      MYSQL_PASSWORD: wordpress
	wordpress:
	  image: wordpress:latest
	  volumes:
	    - ./wp:/var/www/html
	  ports:
	    - "8000:80"
	  restart: always
	  environment:
	    WORDPRESS_DB_HOST: db:3306
	    WORDPRESS_DB_PASSWORD: wordpress
			WORDPRESS_DB_USER: wordpress
```

**docker-compose ì‹¤í–‰**

```bash
$ docker-compose up
```

[localhost:8000](http://localhost:8000) ìœ¼ë¡œ wordpressì™€ MySQLì´ ì‹¤í–‰ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

&nbsp;

### up ëª…ë ¹ì–´

```bash
$ docker-compose up
```

docker composeë¥¼ ì´ìš©í•˜ì—¬ mysqlê³¼ wordpressë¥¼ ì‹¤í–‰í•œë‹¤.

```bash
$ docker-compose up -d
```

`-d` ì˜µì…˜ì„ ì£¼ì–´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì„œë²„ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.

```bash
$ docker-compose up --force-recreate
```

ì»¨í…Œì´ë„ˆë¥¼ ìƒˆë¡œ ë§Œë“¤ê¸°

```bash
$ docker-compose up --build
```

ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë‹¤ì‹œ ë¹Œë“œ (buildë¡œ ì„ ì–¸í–ˆì„ ë•Œë§Œ)

&nbsp;

### start ëª…ë ¹ì–´

```bash
$ docker-compose start
```

ë©ˆì¶˜ ì»¨í…Œì´ë„ˆë¥¼ ì¬ê°œ

```bash
$ docker-compose start wordpress
```

wordpress ì»¨í…Œì´ë„ˆë§Œ ì¬ê°œ

&nbsp;

### down ëª…ë ¹ì–´

```bash
$ docker-compose down
```

ì»¨í…Œì´ë„ˆë¥¼ ì¢…ë£Œí•˜ê³  ì‚­ì œ

&nbsp;

### restart ëª…ë ¹ì–´

```bash
$ docker-compose restart
```

ì»¨í…Œì´ë„ˆë¥¼ ì¬ì‹œì‘

&nbsp;

### stop ëª…ë ¹ì–´

```bash
$ docker-compose stop
```

ì»¨í…Œì´ë„ˆ ë©ˆì¶¤

&nbsp;

### logs ëª…ë ¹ì–´

```bash
$ docker-compose logs
```

ì»¨í…Œì´ë„ˆì˜ ë¡œê·¸

```bash
$ docker-compose logs -f
```

ë¡œê·¸ë¥¼ follow

&nbsp;

### ps ëª…ë ¹ì–´

```bash
$ docker-compose ps
```

ì»¨í…Œì´ë„ˆ ëª©ë¡ì„ ë°˜í™˜

&nbsp;

### exec ëª…ë ¹ì–´

```bash
$ docker-compose exec {ì»¨í…Œì´ë„ˆ ì´ë¦„} {ëª…ë ¹ì–´}
```

ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆì—ì„œ ëª…ë ¹ì–´ ì‹¤í–‰

&nbsp;

### build ëª…ë ¹ì–´

```bash
$ docker-compose build
```

ì»¨í…Œì´ë„ˆ build ë¶€ë¶„ì— ì •ì˜ëœ ë‚´ìš©ëŒ€ë¡œ ë¹Œë“œ

&nbsp;

## ë„ì»¤ ì»´í¬ì¦ˆ íŒŒì¼ ë¬¸ë²•

### version

```yaml
version: '3'
```

`docker-compose.yml` íŒŒì¼ì˜ ëª…ì„¸ ë²„ì „. ë²„ì „ì— ë”°ë¼ ì§€ì›í•˜ëŠ” ë„ì»¤ ì—”ì§„ ë²„ì „ë„ ë‹¤ë¦„

&nbsp;

### services

```yaml
services:
  postgres:
  ...
  django:
  ...
```

ì‹¤í–‰í•  ì»¨í…Œì´ë„ˆ ì •ì˜. `docker run --name django`ì™€ ê°™ë‹¤. 

&nbsp;

### image

```yaml
services:
  postgres:
  ...
  django:
		image: django-sample
```

ì»¨í…Œì´ë„ˆì— ì‚¬ìš©í•  ì´ë¯¸ì§€ ì´ë¦„ê³¼ íƒœê·¸. (íƒœê·¸ë¥¼ ìƒëµí•˜ë©´ latest, ì´ë¯¸ì§€ê°€ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ pull)

&nbsp;

### ports

```yaml
services:
  postgres:
  ...
  django:
  ...
		ports:
			- "8000:8000"
		
```

ì»¨í…Œì´ë„ˆì™€ ì—°ê²°í•  í¬íŠ¸(ë“¤). {í˜¸ìŠ¤íŠ¸ í¬íŠ¸}:{ì»¨í…Œì´ë„ˆ í¬íŠ¸}

&nbsp;

### environment

```yaml
services:
	mysql:
		...
		environment:
			- MYSQL_ROOT_PASSWORD=somewordpress: '3'
```

ì»¨í…Œì´ë„ˆì—ì„œ ì‚¬ìš©í•  í™˜ê²½ë³€ìˆ˜(ë“¤). {í™˜ê²½ë³€ìˆ˜ ì´ë¦„}:{ê°’}

&nbsp;

### volumes

```yaml
services:
	django:
		...
		volumes:
			- ./app:/app
```

ë§ˆìš´íŠ¸í•˜ë ¤ëŠ” ë””ë ‰í„°ë¦¬(ë“¤). {í˜¸ìŠ¤íŠ¸ ë””ë ‰í„°ë¦¬}:{ì»¨í…Œì´ë„ˆ ë””ë ‰í„°ë¦¬}

&nbsp;

### restart

```yaml
services:
	django:
		restart: always
```

ì»¨í…Œì´ë„ˆë¥¼ ì¬ì‹œì‘í•˜ëŠ” ì •ì±…

- restart: "no"
- restart: always
- restart: on-failure
- restart: unless-stopped

&nbsp;

### build

```yaml
django:
	build:
		context: .
		dockerfile: ./compose/django/Dockerfile-dev
```

ì´ë¯¸ì§€ë¥¼ ìì²´ ë¹Œë“œ í›„ ì‚¬ìš©. `image` ì†ì„± ëŒ€ì‹  ì‚¬ìš©í•œë‹¤. ì—¬ê¸° ì‚¬ìš©í•  ë³„ë„ì˜ ë„ì»¤ íŒŒì¼ì´ í•„ìš”í•˜ë‹¤.
