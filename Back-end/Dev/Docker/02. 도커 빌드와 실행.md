# ğŸ³ 02. ë„ì»¤ ë¹Œë“œì™€ ì‹¤í–‰

## ì´ë¯¸ì§€ ë¹Œë“œ

```bash
# ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•œë‹¤.
docker build
# ë¡œì»¬ì— ìˆëŠ” ë¹Œë“œëœ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ í™•ì¸í•œë‹¤.
docker image ls
```

### Dockerfile í™•ì¸

```bash
$ cat Dockerfile
```

```bash
FROM golang:1.8.3

WORKDIR /go/src/hello-docker
COPY main.go /go/src/hello-docker
RUN go get ./...
RUN go install
CMD ["hello-docker"]
```

### Dockerfile ë¹Œë“œ

```bash
# docker build ì£¼ìš” ì˜µì…˜
docker build [OPTIONS] PATH | URL | -
-f, --file
   ë¹Œë“œí•  Dockerfileì„ ì§€ì •í•œë‹¤. ê¸°ë³¸ê°’ì€ Dockerfileì´ë‹¤.
-t, --tag
   ë¹Œë“œí•œ ì´ë¯¸ì§€ì˜ ì´ë¦„(name:tag)ì„ ì§€ì •í•œë‹¤. ë¯¸ì§€ì •ì‹œ <none>ìœ¼ë¡œ ì„¤ì •ëœë‹¤.
```

```bash
docker build -f Dockerfile -t demo:$USER .
```

â†’ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë§Œë“ ë‹¤.

&nbsp;

## ë„ì»¤ ì‹¤í–‰

```bash
# ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•œë‹¤.
docker run
# ì‹¤í–‰í•œ ì»¨í…Œì´ë„ˆë¥¼ í™•ì¸í•œë‹¤.
docker ps
# ì»¨í…Œì´ë„ˆì˜ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•œë‹¤.
docker inspect
# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ì¶”ê°€ ëª…ë ¹ì„ ì‹¤í–‰í•œë‹¤.
docker exec
# ì»¨í…Œì´ë„ˆë¥¼ ì‚­ì œí•œë‹¤.
docker rm
```

### docker run

```bash
# docker run ì£¼ìš” ì˜µì…˜
docker run --help

Usage:  docker run [OPTIONS] IMAGE [COMMAND] [ARG...]

Options:
  -d, --detach            ì»¨í…Œì´ë„ˆë¥¼ backgroundë¡œ ì‹¤í–‰í•œë‹¤.
  --name string           ì»¨í…Œì´ë„ˆì˜ ì´ë¦„ì„ ì§€ì •í•œë‹¤.
  -p, --publish ì™¸ë¶€:ë‚´ë¶€  ì»¨í…Œì´ë„ˆì˜ í¬íŠ¸ë¥¼ hostì˜ í¬íŠ¸ì™€ ì—°ê²°í•œë‹¤.(NAT)
```

```bash
docker run -d --name $USER -p 80 demo:$USER
```

â†’ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•œë‹¤.

### docker ps

```bash
$ docker ps | grep $USER
```

```bash
2d8e9ba89313        demo:krxxxxx        "hello-docker"      About a minute ago   Up About a minute   0.0.0.0:32768->80/tcp   krxxxxx
```

â†’ ì»¨í…Œì´ë„ˆë¥¼ ë¦¬ìŠ¤íŒ…í•œë‹¤.

### docker ps -f (with filter)

```bash
$ docker ps -f name=$USER
```

```
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                   NAMES
2d8e9ba89313        demo:krxxxxx        "hello-docker"      2 minutes ago       Up 2 minutes        0.0.0.0:32768->80/tcp   krxxxxx
```

â†’ filtering ëœ ì»¨í…Œì´ë„ˆë¥¼ ë¦¬ìŠ¤íŒ…í•œë‹¤.

### docker inspect

```bash
$ docker inspect $USER
```

â†’ ì»¨í…Œì´ë„ˆì˜ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•œë‹¤.

### docker inspect -f (with format)

```bash
$ docker inspect $USER --format '{{.NetworkSettings.Ports}}'
```

```bash
map[80/tcp:[{0.0.0.0 32768}]]
```

â†’ ì»¨í…Œì´ë„ˆì˜ ìƒì„¸ì •ë³´ì—ì„œ íŠ¹ì • ì •ë³´ë§Œì„ ì¶”ì¶œí•œë‹¤.

NetworkSettings.Ports ì—ëŠ” Container ë‚´ë¶€ì˜ Port ì™€ NAT ì—°ê²°ëœ Exposed Port ê°€ ì¶œë ¥ë˜ë©° Exposed Port ë¥¼ í†µí•´ Container ì—ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

```bash
$ docker inspect $USER --format '{{.NetworkSettings.Ports}}'
map[80/tcp:[{0.0.0.0 32768}]]
```

```bash
$ echo $DOCKER_HOST
ctestedu-r05n003.shipdock:2375
```

```bash
$ curl ctestedu-r05n003.shipdock:32768
  Hello, docker!

  Hostname:  2d8e9ba89313
  Interfaces:
  - lo:
      IP: 127.0.0.1
  - tunl0:
  - eth0:
      IP: 172.17.0.2
  GET / HTTP/1.1
  Host: localhost:32768
  User-Agent: curl/7.29.0
  Accept: */*
```

### docker exec

```bash
# docker exec ì£¼ìš” ì˜µì…˜
$ docker exec --help

Usage:  docker exec [OPTIONS] CONTAINER COMMAND [ARG...]

Run a command in a running container

Options:
  -d, --detach               ìƒˆë¡œìš´ í„°ë¯¸ë„ì„ í• ë‹¹í•œë‹¤.
  -i, --interactive          STDINì„ ìœ ì§€í•œë‹¤.
```

```bash
$ docker exec -it $USER bash
```

â†’ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ bash ë“±ì˜ ëª…ë ¹ì„ ì‹¤í–‰í•œë‹¤.

- ì¢…ë£Œ ì‹œì—ëŠ” Ctrl-D ë‚˜ exit ë¥¼ ì‹¤í–‰í•œë‹¤.

### docker rm

```bash
# docker rm ì£¼ìš” ì˜µì…˜
$ docker rm --help

Usage:  docker rm [OPTIONS] CONTAINER [CONTAINER...]

Remove one or more containers

Options:
  -f, --force     ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆë¥¼ ê°•ì œë¡œ ì‚­ì œí•œë‹¤.
```

```bash
$ docker rm -f $USER
```

â†’ ì»¨í…Œì´ë„ˆë¥¼ ì‚­ì œ í•œë‹¤.

&nbsp;

## ì´ë¯¸ì§€ ë°°í¬ì™€ ì‹¤í–‰

```bash
# ê¸°ì¡´ ì´ë¯¸ì§€ë¥¼ ì°¸ì¡°í•˜ëŠ” ìƒˆ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•œë‹¤.
docker tag
# ë¡œì»¬ì˜ ì´ë¯¸ì§€ë¥¼ ì›ê²©ì˜ ì €ì¥ì†Œë¡œ ì˜¬ë¦°ë‹¤.
docker push
# ì›ê²©ì˜ ì´ë¯¸ì§€ë¥¼ ë¡œì»¬ì˜ ì €ì¥ì†Œë¡œ ë‚´ë ¤ë°›ëŠ”ë‹¤.
docker pull
```

### docker tag

- ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ì°¸ì¡°í•˜ëŠ” ìƒˆë¡œìš´ ì´ë¦„ì˜ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•œë‹¤.

```bash
$ docker tag --help
```

```bash
Usage:  docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]
```

```bash
$ docker tag demo:$USER registry.navercorp.com/edu/demo:$USER
```

registry.navercorp.com ì€ ì‚¬ë‚´ Private Docker Registry ì£¼ì†Œì´ë‹¤.Â [Guide](https://oss.navercorp.com/shipdock/artifactory_issue/wiki)

- ìƒˆë¡œ ìƒì„±ëœ ì´ë¯¸ì§€ í™•ì¸

```bash
$ docker image ls
```

```bash
REPOSITORY                        TAG                 IMAGE ID            CREATED             SIZE
demo                              krxxxxx             79df01ab651a        4 hours ago         707MB
registry.navercorp.com/edu/demo   krxxxxx             79df01ab651a        4 hours ago         707MB
golang                            1.8.3               7e62a8729fa7        6 months ago        699MB
```

### docker login

- ë„ì»¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ë¡œê·¸ì¸í•œë‹¤. (naver:naver)

```bash
$ docker login registry.navercorp.com
#Username (naver): naver
#Password: naver
#Login Succeeded
```

ë¡œê·¸ì¸ì´ ë˜ë©´ ~/.docker/config.json ì— Credential ì •ë³´ê°€ ì €ì¥ë˜ë¯€ë¡œ ê³µìš© ì„œë²„ì—ì„œëŠ” í† í° ë“±ì„ ë°œê¸‰ë°›ì•„ì„œ ì‚¬ìš©í•˜ê¸¸ ê¶Œì¥í•œë‹¤.

### docker push

- ë¡œì»¬ì— ë‚´ ì´ë¯¸ì§€ (ì´ë¦„:í…Œê·¸) ë¥¼ ì›ê²©ì˜ Registry ì— ë°€ì–´ë„£ëŠ”ë‹¤.

```bash
$ docker push registry.navercorp.com/edu/demo:$USER
```

- ì•„ë˜ ì£¼ì†Œë¡œ ì ‘ê·¼í•˜ì—¬ ë‚´ ì´ë¯¸ì§€ê°€ ì •ìƒì ìœ¼ë¡œ í‘¸ì‰¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.Â [http://registry.navercorp.com/webapp/#/artifacts/browse/tree/General/dev/edu/demo](http://registry.navercorp.com/webapp/#/artifacts/browse/tree/General/dev/edu/demo)

### Registry ì˜ ì´ë¯¸ì§€ë¡œ ë„ì»¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰

- ë¡œì»¬ì˜ ë‚´ ì´ë¯¸ì§€ ì‚­ì œ

```bash
# ë‚´ê°€ ìƒì„±í•œ ì´ë¯¸ì§€ ì‚­ì œ
$ docker image rm demo:$USER registry.navercorp.com/edu/demo:$USER
```

```bash
$ docker image ls
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
golang              1.8.3               7e62a8729fa7        6 months ago        699MB
```

- Registry ì˜ ì´ë¯¸ì§€ë¡œ ì‹¤í–‰

```bash
$ docker run -d --name $USER -p 80 registry.navercorp.com/edu/demo:$USER
```

- ì´ë¯¸ì§€ Pull ë° ì‹¤í–‰ í™•ì¸

```bash
$ docker ps -f name=$USER
CONTAINER ID        IMAGE                                     COMMAND             CREATED             STATUS              PORTS                   NAMES
6d382e7cfe4b        registry.navercorp.com/edu/demo:krxxxxx   "hello-docker"      9 seconds ago       Up 8 seconds        0.0.0.0:32769->80/tcp   krxxxxx
$ docker rm -f $USER
krxxxxx
$ docker image ls
REPOSITORY                        TAG                 IMAGE ID            CREATED             SIZE
registry.navercorp.com/edu/demo   krxxxxx             79df01ab651a        4 hours ago         707MB
golang                            1.8.3               7e62a8729fa7        6 months ago        699MB
```

- ë‹¤ìŒ ì‹¤ìŠµì„ ìœ„í•´ ìƒì„±í•œ ì»¨í…Œì´ë„ˆ ì‚­ì œ

```bash
$ docker rm -f $USER
```
