# 클라우드 컴퓨팅 요소 기술

- 가상화 (Virtualization)
- 클러스터 관리 (Cluster Managements)
- 분산 시스템 (Distributed System)
- SaaS 플랫폼 (SaaS Platform)

⇒ 클라우드 컴퓨팅 서비스를 가능하게 해주는 기술들

---

## 참고

[[Container 시리즈] 00. Container/ Docker란 뭔가요?](https://tech.osci.kr/2020/03/03/91690167/)

### **컨테이너**

리눅스 기술을 사용하여 프로세스가 사용하는 자원을 격리

컨테이너는 가상머신과 마찬가지로 애플리케이션을 관련 라이브러리 및 종속 항목과 함께 패키지로 묶어 SW서비스 구동을 위한 격리 환경을 마련

### 도커

*' 필요한 것은 미리 만들어 놓자!* *'* ⇒ 이미지 (Docker Image)

Docker file : 이미지의 버전관리를 위한 코드화 관리 도구

Docker Engine : Guest OS와 그의 커널 없이 **앱 내 명령을 host OS 까지 전달**.

→ 도커엔진이 Guest OS에서 실행되는 명령을 host OS의 커널이 이해할 수 있게 바꿔 줌

(cf. 하이퍼바이저 : Guest OS에 있는 Kernel이 하이퍼 바이저에 명령을 전달하고 하이퍼 바이저가 다시 Cent OS의 Kernel로 명령어를 전달)

---

## Containers vs. Virtual Machines


<img width="992" alt="스크린샷 2020-09-29 오전 11 48 40" src="https://user-images.githubusercontent.com/45806836/94507009-ba83cc80-0249-11eb-8366-8b3cc5af6ee8.png">


**컨테이너**: 개발, 복제, 배포를 위해 소프트웨어를 표준화된 단위로 패키징 한 것.

컨테이너와 가상 머신은 자원 분리와 할당 역할을 한다.

- 가상머신: 하드웨어를 가상화 한 것

 - 하나의 서버를 여러 개의 서버로 바꾸어 주는 물리적 하드웨어의 추상화

 - hypervisor를 사용하여 호스트 머신에서 여러 개의 VM을 실행할 수 있음

 - 각 VM 안에는 Guest OS, App. 필요한 바이너리, 라이브러리가 포함되어 크기는 수십 GB 일 수도 있음

 - 여러 OS를 써야 하는 환경에서는 (컨테이너 기반 가상화가 아니라) 하이퍼바이저를 통한 하드웨어 가상화가 필요

- 컨테이너: 운영체제를 가상화 한 것, 이식성/ 휴대성이 높고 효율적

 - 코드와 종속성을 함께 패키지화하는 앱 계층의 추상화

 - 여러 컨테이너가 동일한 컴퓨터 상에서 실행 가능

 - OS 커널은 여러 컨테이너가 공유하지만 각 컨테이너는 사용자 공간에서 독립적으로 격리된 프로세스로 실행

 - VM 보다 차지하는 공간이 적다 (컨테이너 이미지 크기 : 수십 MB 정도)

<img width="358" alt="스크린샷 2020-09-29 오전 11 49 03" src="https://user-images.githubusercontent.com/45806836/94507027-c7a0bb80-0249-11eb-84f6-ccdb8e5a7099.png">

**Container**

: 개발, 복제, 배포를 위해 소프트웨어를 표준화된 단위로 패키징 한 것

컨테이너 안에는 코드와 모든 종속성이 다 포함되어 있어서, 응용이 서로 다른 실행 환경에서도 신속하고 안정적으로 실행된다.

**Docker Container Image**

: 경량, 독립 실행 가능한 소프트웨어 패키지

코드, 런타임, 시스템 도구, 시스템 라이브러리와 설정 등 응용 실행에 필요한 모든 것이 포함

**Docker Engine**

: 컨테이너를 생성, 관리, 배포, 실행

2013년 Docker 회사에서 발표한 오픈 소스 엔진

**Docker Container Image**를 런타임에 컨테이너로 만들어 실행시킨다.

---

## Docker and Kubernetes

### 도커

컨테이너 이미지 생성, 관리, 공유, 구동을 쉽게 해준다.

***여러 컨테이너들을 모아 큰 응용을 구축한다면?***

컨테이너 오케스트레이션 필요: 컨테이너를 스케줄링, 클러스터링, 로깅, 모니터링

### 쿠버네티스

컨테이너 오케스트레이션 툴

- 여러 컨테이너들을 모아 큰 응용을 만들 때, 이들을 배치, 연결, 확장해 준다.
- 서비스 중단 없이 업데이트가 가능하도록 한다.
- 특정 컨테이너가 fail하면 그 컨테이너를 복제 생성해서 서비스를 유지한다.

---

## 클러스터 관리

- **컴퓨터 클러스터 (Cluster)**

: 대용량 계산을 하거나 데이터를 저장하기 위해 여러 대의 컴퓨팅 자원을 하나로 묶어 놓은 시스템

 - 클라우드 컴퓨팅 서비스를 제공하는 클라우드 (시스템) 역시 대형 클러스터 시스템으로 볼 수 있음

- **클러스터 관리**

 - 노드 관리

 - 자동 업데이트 및 자동 설치

 - 프로비저닝, 로드 밸런싱, 자동 확장성 등의 제공이 필요

## 컴퓨터 클러스터의 분류

- 고가용성 클러스터 (HA Cluster = Failover Cluster)

: 서비스가 계속 되어야 하는 시스템에 사용(서비스 가용성)

 - 1대가 주 서버(Active) 역할, 나머지는 보조 서버(Standby)

→ 주 서버 fail 시 보조 중 1대가 주 서버로 선출, 가용성 유지

 - Google 에서는 Chubby라는 Failover 클러스터를 구현해 사용

- **컴퓨팅 클러스터 (HPC Cluster)**

 - 고성능 계산을 제공하기 위한 목적으로 구성된 컴퓨터들의 집합

Ex. 기상 예측, 기체 역학 시뮬레이션 등

- 부하 분산 클러스터 (Load Balancing Cluster)

 - 방법 1) 1대 이상(한 대만 두면 병목현상이 생길수도)의 부하를 분산시키는 프런트 시스템 (load balancer) 이 있으며, 이 프런트 시스템이 사용자 요청을 받는 작업을 담당. 사용자의 요청을 백엔드(Backend) 시스템들에 분배 시켜 주는 방식으로 클러스터가 동작 

 - 방법 2) 각 노드에 load balancer 가 builtin 되어 있음. load balancing 이 분산처리 되는 방식

 - 방법 3) LBaaS : Load Balancing as a Service

로드 밸런싱을 서비스로 받을 수 있음
Ex. Cloudflare의 로드밸런싱 서비스 (https://www.failednormal.com/)

## 클러스터 관리 - 주요 기능

### 노드 관리

- 노드 (node) 는 클러스터를 구성하는 각각의 시스템 (하나의 컴퓨터)
- 시스템의 가용 상태를 계속 유지할 수 있어야 함

    → 고장난 노드 신속 복구

- 노드를 유연하게 운영해야 함

    → 기업의 요구에 맞추어 노드들을 신속하게 추가/삭제할 수 있어야 함

    → 물리적 서버에 대해서도 노드 관리가 이루어져야 하지만, 가상화 된 서버들에 대해서도 이루어져야 함

- 노드 모니터링 작업: 부하 분산, 프로세스 이동,클러스터 관리 등을 위한 기초 정보로 활용

### 자동 업데이트 및 자동 설치 기능

- 클러스터 전체 범위에 걸쳐 특정 기능 및 보안 관련 프로그램의 업데이트/설치/삭제 자동화로 해당 관리 업무 효율성/효과 확보

### 프로비저닝 및 작업 관리

- 사용자권한을클러스터내자원할당과연계해야함
- 클러스터 내 유휴 자원을 실시간으로 할당, 서비스를 생성/실행해야 함
- 서비스 생성, 실행, 종료, 사용자 통보, 자원 해제 등을 지원

### 로드 밸런싱 및 자동 확장성

- 클러스터 내 특정자원에 대한 요청이 집중되는 병목현상 방지 및 해소
- 각 사용자의 요청이나 자원 활용 상황에 따라 필요 자원을 적절히 할당
- WorkLoad의 급증에 대비한 동적 자원 재 할당 지원

---

## 분산 데이터 관리

### 분산 데이터 관리 시스템

대규모의 구조화된 데이터를 여러 부분으로 나눈 후, 분산 저장, 관리 하는 시스템

- 클라우드 서비스 지원을 위한 요구 조건

    **확장성 
    :** 데이터 ****사용 요구 및 데이터 양 급증에 대응하여 동적으로 관련 시스템을 추가할 수 있도록 유연해야 함

    **고가용성**

    : 동일 데이터에 대한 복제본을 다수의 분산된 위치에 저장하여 데이터 유실 및 서비스 중단을 막아야 함.

    **고속 처리**

    : 단순화된 데이터베이스 조회 연산으로, 사용자 요청의 고속 처리를 지원해야 함

## 분산 병렬 처리

: 데이터는 여러 노드에 분산되어 저장, 그 데이터를 대상으로 병렬 고성능 처리

- 네트워크를 통해 연결된 다수의 노드들, 즉 클러스터 상에서 연산 작업을 병렬로 (동시에) 수행하는 기술
- 대용량 데이터를 적정한 시간 내에 가공/분석하기 위하여 분산 병렬 처리 기술이 활용됨
- 구글의 2004년 **맵리듀스** (MapReduce) 병렬처리 시스템
    - 구글이 개발한 소프트웨어 프레임워크
    - 이어서 야후, 하둡에서 추가 기술 개발

## 분산 파일 시스템

: 가상의 거대한 파일 시스템, 데이터가 여러 컴퓨터에 나누어 저장됨

- DFS (distributed file system) :
    - 막대한 양의 데이터를 저장하고 관리하기 위해 수많은 서버들에 데이터를 나누어 저장하고 관리하는 파일 시스템
- 클라이언트는 마치 자신의 단말기에 데이터가 저장된 듯 서비스를 받음
- 하드웨어 장애에 유연하게 대처해야 함 (Ex. 복사본 저장)
- 고성능 만족시켜야 함

---

## SaaS 플랫폼: Multi-Tenancy 기술

: 클라우드 컴퓨팅 기술 중 **소프트웨어** **제품을** 구매/설치하지 않고 인터넷에 접속해 서비스 형태로 빌려 쓰는 모델

- Multi-Tenant solution

    *여러 사용자 (또는 회사)가 동일한 서버 리소스를 공유* 할 수 있음

   
    자신만의 공간은 있으나, 공유 자원은 변경할 수 없음

## Multi-Tenant 데이터 관리 예제

여러 사용자가 데이터베이스의 어떤 부분을 공유하는가?

### separate databases

<img width="358" alt="스크린샷 2020-09-29 오전 11 49 03" src="https://user-images.githubusercontent.com/45806836/94507027-c7a0bb80-0249-11eb-84f6-ccdb8e5a7099.png">

- 각 tenant는 자신만의 database를 소유한다.

### shared database, separate schemas

<img width="694" alt="스크린샷 2020-09-29 오전 11 50 32" src="https://user-images.githubusercontent.com/45806836/94507111-fc147780-0249-11eb-8280-e7f43c259189.png">
  
- database는 공유하지만, 각 tenant는 자신만의 table과 schema를 가진다.

### shared database, shared schemas


<img width="789" alt="스크린샷 2020-09-29 오전 11 51 22" src="https://user-images.githubusercontent.com/45806836/94507169-1b130980-024a-11eb-8ec3-869d3ce63a21.png">


- database와 Table을 공유한다. Table의 tenantID 열로, 해당 행이 어떤 tenant의 소유인지 구분한다.

⇒ Multi-tenancy 기술을 다양한 level로 적용할 수 있다!

# SaaS 성숙도 모델

## 1단계

: ***개별 고객마다 한 copy,*** 소스코드를 수정한 SW (커스터마이징) 제공

전통적인 애플리케이션 제공 서비스

SW 인스턴스는 완전히 독립적으로 유지

Client-Server 구조

관리가 복잡하고 비용이 크게 든다.

## 2단계

: 고객별로 별도의 응용 소프트웨어를 제공하지만, ***고객별 환경 설정*** 이 가능하다

메타 데이터를 사용하여 환경 설정을 한다.
SW 인스턴스는 여전히 분리되어 있다.
## 3단계

: ***모든 고객을 하나의 인스턴스로 지원*** 하고, 메타 데이터를 통해 고객 환경 설정이 가능하다.

메타 데이터를 사용하여 환경 설정을 한다.
SW 인스턴스는 여전히 분리되어 있다.  


## 4단계

: ***고객의 수에 따라 인스턴스 증감*** ***Tenant Load Balancer가 로드 밸런싱***

메타 데이터를 사용하여 환경 설정을 한다.
SW 인스턴스는 여전히 분리되어 있다.  
